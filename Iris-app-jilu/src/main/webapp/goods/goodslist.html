<!DOCTYPE html>
<html>
<head>
<title>后台管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<script type="text/javascript" src="../scripts/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../scripts/public.js"></script>
<script type="text/javascript" src="../scripts/mydate.js"></script>
<script type="text/javascript" src="../scripts/islogin.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<link href="../bootstrap-3.3.5-dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="../bootstrap-3.3.5-dist/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<link href="../css/dashboard.css" rel="stylesheet" />
<link href="../css/menu.css" rel="stylesheet" />
<style type="text/css">
	/*a  upload */
.a-upload {
    padding: 4px 10px;
    height: 30px;
    line-height: 20px;
    position: relative;
    cursor: pointer;
    color: #888; 
    background: #fafafa;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    display: inline-block;
    *display: inline;
    *zoom: 1
}

.a-upload  input {
    position: absolute;
    font-size: 100px;
    color:blue;
    right: 0;
    top: 0;
    opacity: 0;
    filter: alpha(opacity=0);
    cursor: pointer
}

.a-upload:hover {
    color: #444;
    background: #eee;
    border-color: #ccc;
    text-decoration: none
}
.file {
    position: relative;
    display: inline-block;
    background: #D0EEFF;
    border: 1px solid #99D3F5;
    border-radius: 4px;
    padding: 4px 12px;
    overflow: hidden;
    color: #1E88C7;
    text-decoration: none;
    text-indent: 0;
    line-height: 20px;
}
.file input {
    position: absolute;
    font-size: 100px;
    right: 0;
    top: 0;
    opacity: 0;
}
.file:hover {
    background: #AADFFD;
    border-color: #78C3F3;
    color: #004974;
    text-decoration: none;
}
</style>
</head>
<body>
	<nav id="main-top" class="navbar navbar-inverse navbar-fixed-top">
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2">
				<ul id="main-nav" class="main-nav nav nav-tabs nav-stacked" style="">
				</ul>
			</div>
			<div class="col-md-10">
			<h2 class="sub-header">产品列表<button type="button" class="btn btn-default" onclick="add()"><span class="glyphicon glyphicon-plus"></span> 添加</button></h2>
			<div>
				<a href="javascript:;" class="a-upload">
					<input type="file" name="upload_goods" id="upload_goods" onChange="uploadGoods()">导入产品
				</a>
                <a href ="/jilu/backstage?action=goods_list_file" class="a-upload">导出产品</a>
				<a href = "javascript:downlist();"><font size="2px">导入产品模板下载</font></a>
                
			</div>
				<form role="form">
				<div class="form-inline form-group">
						<label for="zhName_">中文名称：</label> <input class="form-control"
							id="zhName_" placeholder="中文名称">
						<label for="alias_">别名：</label> <input class="form-control"
							id="alias_" placeholder="别名">
						<label for="goodsCode_">条形码：</label> <input class="form-control"
							id="goodsCode_" placeholder="条形码">
						<!--
						<label for="begindate">注册时间：</label>
						<div class="input-group date form_date" data-date=""
							data-date-format="yyyy-mm-dd" data-link-field="begindate"
							data-link-format="yyyy-mm-dd">
							<input class="form-control" size="16" type="text" value=""
								readonly> <span class="input-group-addon"><span
								class="glyphicon glyphicon-calendar"></span></span>
						</div>
						<input type="hidden" id="begindate" value="" />
						<div class="input-group date form_date" data-date=""
							data-date-format="yyyy-mm-dd" data-link-field="enddate"
							data-link-format="yyyy-mm-dd">
							<input class="form-control" size="16" type="text" value=""
								readonly> <span class="input-group-addon"><span
								class="glyphicon glyphicon-calendar"></span></span>
						</div>
						<input type="hidden" id="enddate" value="" />
						-->
						<button type="button" class="btn btn-default" onclick="search()">
							<span class="glyphicon glyphicon-search"></span> 查询
						</button>
					</div>
				
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover">
							<thead>
								<tr>
									<th>条形码</th>
									<th>中文名称</th>
									<th>英文名称</th>
									<th>产品规格</th>
									<th>分类</th>
									<th>别名</th>
									<th>价格</th>
									<th>来源</th>
									<th>更新时间</th>
									<th width="180px">操作</th>
								</tr>
							</thead>
							<tbody id="list">
							</tbody>
						</table>
						<nav aria-label="Page navigation">
						  <ul class="pagination" id="pagecount">
						  </ul>
						</nav>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- 添加商品-->
	<div class="modal fade" tabindex="-1" role="dialog" id="modal">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">添加/修改商品</h4>
				</div>
				<div class="modal-body">
					<input class="form-control" id="goodsId" type='hidden'>	
					<div class="form-group">
						<label for="goodsCode">*条形码：</label> 
						<input class="form-control" id="goodsCode" >
					</div>
					<div class="form-group">
						<label for="zhName">*中文名称：</label> 
						<input class="form-control" id="zhName" >
					</div>
					<div class="form-group">
						<label for="goodsFormat">*规格：</label> 
						<input class="form-control" id="goodsFormat" >
					</div>
					<div class="form-group">
						<label for="usName">英文名称：</label> 
						<input class="form-control" id="usName" >
					</div>
					<div class="form-group">
						<label for="classification">分类：</label> 
						<input class="form-control" id="classification" >
					</div>
					<div class="form-group">
						<label for="zhBrand">中文品牌：</label> 
						<input class="form-control" id="zhBrand" >
					</div>
					<div class="form-group">
						<label for="usBrand">英文品牌：</label> 
						<input class="form-control" id="usBrand" >
					</div>
					<div class="form-group">
						<label for="unit">单位：</label> 
						<input class="form-control" id="unit" >
					</div>
					<div class="form-group">
						<label for="weight">重量：</label> 
						<input class="form-control" id="weight" >
					</div>
					<div class="form-group">
						<label for="alias">别名：</label> 
						<input class="form-control" id="alias" >
					</div>
					<div class="form-group">
						<label for="sku">sku：</label> 
						<input class="form-control" id="sku" >
					</div>
					<div class="form-group">
						<label for="barcode">barcode：</label> 
						<input class="form-control" id="barcode" >
					</div>
					<div class="form-group">
						<label for="unitPrice">单价：</label> 
						<input class="form-control" id="unitPrice" >
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick="save()">保存</button>
				</div>
			</div>
		</div>
	</div>
	
	<script type="text/javascript" src="../scripts/menu.js"></script>
	<script type="text/javascript">
	$(document).ready(function() {
		getData(1);
	});
	getData=function(page) {
        $.ajax({
            type: 'POST',
            url: '/jilu/backstage',
            data: { 'page': page, 'pageSize': pageSize, 'action': 'goods_list',
            	'zhName':$("#zhName_").val(),'alias':$("#alias_").val(),'goodsCode':$("#goodsCode_").val()},
            dataType: 'json',
            beforeSend: function () {
            	initLoading();
            	showLoading("正在加载数据，请稍候。。。");
            },
            success: function (json) {
            	hideLoading();
            	RemoveLoading();
            	$("#list").empty();//清空数据区
            	var tr= "";
            	var list = json.data.list;
            	total = json.data.total; //总记录数
            	curPage = page; //当前页
                totalPage = Div(total, pageSize);
                $.each(list, function (index, array) { //遍历json数据列
               		tr +="<tr><td>" + array['goodsCode'] + 
               		"</td><td>" + array['zhName'] + "</td><td>" + array['usName'] + "</td><td>" 
               		+ array['goodsFormat'] + "</td><td>" + array['classification'] + "</td><td>" 
               		+ array['alias'] + "</td><td>" + array['unitPrice'] + "</td><td>" + array['merchantName'] + "</td><td>" + array['updateTime'] + "</td>"+
               		"<td><a href='javascript:void(0)' class='btn btn-info btn-xs' onclick='info("+array['goodsId']+")'>编辑</a>"+
               		"&nbsp;&nbsp;&nbsp;&nbsp;<a href='javascript:void(0)' class='btn btn-danger btn-xs' onclick='del("+array['goodsId']+")'>删除</a>"+
               		"</td></tr>";
                });
                
                $("#list").append(tr);
            },
            complete: function () { //生成分页条
            	if(totalPage>1)
        		{
            		getPageBar();
        		}else{
        			$("#pagecount").empty();
        		}
            },
            error: function () {
                alert("数据加载失败");
            }
        });
    }
	downlist = function(){
		$.ajax({
            type: 'POST',
            url: '/jilu/backstage',
            data: { 'action': 'goods_list_file',
            	'zhName':$("#zhName_").val(),'alias':$("#alias_").val(),'goodsCode':$("#goodsCode_").val()},
            dataType: 'json',
            beforeSend: function () {
            	initLoading();
            	showLoading("正在加载数据，请稍候。。。");
            },
            success: function (json) {
            	hideLoading();
            	RemoveLoading();
            },
            complete: function () { 
            },
            error: function () {
                alert("数据下载失败");
            }
        });	
	}
	add = function(){
		$('#zhName').val("");
		$('#goodsCode').val("");
		$('#goodsFormat').val("");
		$('#usName').val("");
		$('#classification').val("");
		$('#zhBrand').val("");
		$('#usBrand').val("");
		$('#unit').val("");
		$('#weight').val("");
		$('#alias').val("");
		$('#sku').val("");
		$('#barcode').val("");
		$('#unitPrice').val("");
		$('#modal').modal('show');
	}
	
	save = function(){
		var goodsId = $("#goodsId").val();
		var zhName= $("#zhName").val();
		var goodsCode = $("#goodsCode").val();
		var goodsFormat = $("#goodsFormat").val();
		if(zhName == "" || goodsCode == "" || goodsFormat == ""){
			alert("中文名，条形码，规格是必填项！");
			return;
		}
		$.ajax({
			type:"post",
			url: '/jilu/backstage',
			data:{'action': goodsId==''?'goods_add':'goods_edit','goodsId':goodsId,'goodsCode':goodsCode,'zhName':zhName,'goodsFormat':goodsFormat,'usName':$("#usName").val(),
				'classification':$("#classification").val(),'zhBrand':$("#zhBrand").val(),'usBrand':$("#usBrand").val(),'unit':$("#unit").val(),
				'weight':$("#weight").val(),'alias':$("#alias").val(),'sku':$("#sku").val(),'barcode':$("#barcode").val(),'unitPrice':$("#unitPrice").val()},
			dataTyp:'json',
			 success: function (json) {
	            	if(json.code=="0"){
	            		hideLoading();
	            		getData(curPage);
	            	}
	            	else{
	            		hideLoading();
	            		alert(json.desc);
	            	}
	            },
	            error: function () {
	                alert("数据加载失败");
	            }
		});
		$('#modal').modal('hide');
	}
	
	info = function(goodsId){
		$.ajax({
			type:"post",
			url: '/jilu/backstage',
			data:{'action': 'goods_info','goodsId':goodsId},
			dataTyp:'json',
			success: function (json) {
            	if(json.code=="0"){
            		var goods = json.data;
            		$('#goodsId').val(goodsId);
            		$('#zhName').val(goods.zhName);
            		$('#goodsCode').val(goods.goodsCode);
            		$('#goodsFormat').val(goods.goodsFormat);
            		$('#usName').val(goods.usName);
            		$('#classification').val(goods.classification);
            		$('#zhBrand').val(goods.zhBrand);
            		$('#usBrand').val(goods.usBrand);
            		$('#unit').val(goods.unit);
            		$('#weight').val(goods.weight);
            		$('#alias').val(goods.alias);
            		$('#sku').val(goods.sku);
            		$('#barcode').val(goods.barcode);
            		$('#unitPrice').val(goods.unitPrice);
            	}
            	else{
            		alert(json.desc);
            	}
	        },
            error: function () {
                alert("数据加载失败");
            }
		});
		$('#modal').modal('show');
	}
	
	del = function(goodsId){
		if (confirm("确定要删除该产品吗？")) {
			$.ajax({
				type:"post",
				url: '/jilu/backstage',
				data:{'action':"goods_remove",'goodsId':goodsId},
				dataTyp:'json',
				 success: function (json) {
		            	if(json.code=="0"){
		            		alert(json.desc);
		            		getData(curPage);
		            	}
		            	else{
		            		hideLoading();
		            		alert(json.desc);
		            	}
		            },
		            error: function () {
		                alert("数据加载失败");
		            }
			});
		}
	}
	
	var file;
	uploadGoods = function(){
		var formData = new FormData();
		formData.append("upload_goods", document.getElementById("upload_goods").files[0]);   
		formData.append("action","upload_goods");
		$.ajax({
            type: 'POST',
            url: '/jilu/fileupload',
            data: formData,
            dataType: 'json',
            async: false,
            contentType: false,  
            processData: false,
            beforeSend: function () {
				initLoading();
				showLoading("导入中。。。");
            },	
            success: function (json) {
            	RemoveLoading();
            	if(json.code=="0"){
            		alert("成功导入"+json.data+"条产品信息！");
            		getData(1);
            	}
            	else {
					alert(json.desc)
				}
            },
            error: function () {
                alert("数据加载失败");
            }
        });
		$("#upload_goods").val('');
	}

</script>
</body>
</html>