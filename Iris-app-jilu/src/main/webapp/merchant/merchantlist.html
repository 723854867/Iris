<!DOCTYPE html>
<html>
<head>
<title>后台管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<script type="text/javascript" src="../scripts/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../scripts/public.js"></script>
<script type="text/javascript" src="../scripts/mydate.js"></script>
<script type="text/javascript" src="../scripts/islogin.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<link href="../bootstrap-3.3.5-dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="../bootstrap-3.3.5-dist/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<link href="../css/dashboard.css" rel="stylesheet" />
<link href="../css/menu.css" rel="stylesheet" />
</head>
<body>
	<nav id="main-top" class="navbar navbar-inverse navbar-fixed-top">
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2">
				<ul id="main-nav" class="main-nav nav nav-tabs nav-stacked" style="">
				</ul>
			</div>
			<div class="col-md-10">
			<h2 class="sub-header">商户列表</h2>
				<form role="form">
					<div class="form-inline form-group">
						<label for="name">名字：</label> <input class="form-control"
							id="name" placeholder="名字">
						<button type="button" class="btn btn-default" onclick="search()">
							<span class="glyphicon glyphicon-search"></span> 查询
						</button>
					</div>
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover">
							<thead>
								<tr>
									<th>名称</th>
									<th>地址</th>
									<th>最近登录时间(UTC)</th>
									<th>商户余额</th>
									<th width="180px">操作</th>
								</tr>
							</thead>
							<tbody id="list">
							</tbody>
						</table>
						<nav aria-label="Page navigation">
						  <ul class="pagination" id="pagecount">
						  </ul>
						</nav>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../scripts/menu.js"></script>
	<script type="text/javascript">
	$(document).ready(function() {
		getData(1);
	});
	getData=function(page) {
        $.ajax({
            type: 'POST',
            url: '/jilu/backstage',
            data: { 'page': page, 'pageSize': pageSize, 'action': 'merchant_list','name':$("#name").val()},
            dataType: 'json',
            beforeSend: function () {
            	initLoading();
            	showLoading("正在加载数据，请稍候。。。");
            },
            success: function (json) {
            	hideLoading();
            	RemoveLoading();
            	$("#list").empty();//清空数据区
            	var tr= "";
            	var list = json.data.list;
            	total = json.data.total; //总记录数
            	curPage = page; //当前页
                totalPage = Div(total, pageSize);
                $.each(list, function (index, array) { //遍历json数据列
               		tr +="<tr><td>" + array['name'] + 
               		"</td><td>" + array['address'] + "</td><td>" + DateFormat.prototype.format(new Date(array['lastLoginTime']*1000),DateFormat.prototype.UTC_FORMAT) + "</td><td>" + array['money'] + "</td>";
               		if(array.delFlag == 0){
               			tr +="<td><a href='javascript:void(0)' class='btn btn-danger btn-xs' onclick='disableAccount("+array['merchantId']+")'>黑名单</a>";
               		}else{
               			tr +="<td><a href='javascript:void(0)' class='btn btn-warning btn-xs' onclick='cannelDisable("+array['merchantId']+")'>取消黑名单</a>";
               		}
               		tr +="</td></tr>";
                });
                
                $("#list").append(tr);
            },
            complete: function () { //生成分页条
            	if(totalPage>1)
        		{
            		getPageBar();
        		}else{
        			$("#pagecount").empty();
        		}
            },
            error: function () {
                alert("数据加载失败");
            }
        });
    }
	disableAccount = function(merchantId) {
		if (confirm("确定要封禁该账号吗？")) {
			$.ajax({
				type : 'POST',
				url : '/jilu/backstage',
				data : {
					'merchantId' : merchantId,
					'type' : 0,
					'action' : 'merchant_operation'
				},
				dataType : 'json',
				beforeSend : function() {
					initLoading();
					showLoading("正在处理，请稍候。。。");
				},
				success : function(json) {
					if (json.code == "0") {
						hideLoading();
						getData(curPage);
					} else {
						hideLoading();
						alert(json.desc);
					}
				},
				error : function() {
					alert("数据加载失败");
				}
			});
		}
	}
	cannelDisable = function(merchantId) {
		if (confirm("确定要解除封禁该账号吗？")) {
			$.ajax({
				type : 'POST',
				url : '/jilu/backstage',
				data : {
					'merchantId' : merchantId,
					'type' : 1,
					'action' : 'merchant_operation'
				},
				dataType : 'json',
				beforeSend : function() {
					initLoading();
					showLoading("正在处理，请稍候。。。");
				},
				success : function(json) {
					if (json.code == "0") {
						hideLoading();
						getData(curPage);
					} else {
						hideLoading();
						alert(json.desc);
					}
				},
				error : function() {
					alert("数据加载失败");
				}
			});
		}
	}

	
</script>
</body>
</html>