<!DOCTYPE html>
<html>
<head>
<title>后台管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<script type="text/javascript" src="../scripts/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../scripts/public.js"></script>
<script type="text/javascript" src="../scripts/mydate.js"></script>
<script type="text/javascript" src="../scripts/islogin.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/css/bootstrap.min.css"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<link href="../bootstrap-3.3.5-dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="../bootstrap-3.3.5-dist/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<link href="../css/dashboard.css" rel="stylesheet" />
<link href="../css/menu.css" rel="stylesheet" />
</head>
<body>
	<nav id="main-top" class="navbar navbar-inverse navbar-fixed-top">
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2">
				<ul id="main-nav" class="main-nav nav nav-tabs nav-stacked" style="">
				</ul>
			</div>
			<div class="col-md-10">
			<h2 class="sub-header">版本列表</h2>
				<form role="form">				
				<div class="form-inline form-group">
						<button type="button" class="btn btn-default" onclick="add()"><span class="glyphicon glyphicon-plus"></span> 添加</button>
					</div>	
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover ">
							<thead>
								<tr>
									<th><input type="checkbox" id="checkAll" name="checkAll" /></th>
									<th>id</th>
									<th>版本号</th>
									<th>强制升级</th>
									<th>是否启用</th>
									<th>创建时间</th>
									<th>更新时间</th>
									<th>版本更新内容</th>
									<th>下载地址</th>
									<th>操作系统</th>
									<th width="130px">操作</th>
								</tr>
							</thead>
							<tbody id="list">
							</tbody>
						</table>
						<nav aria-label="Page navigation">
						  <ul class="pagination" id="pagecount">
						  </ul>
						</nav>
					</div>
					
				</form>
			</div>
		</div>
	</div>
	<!-- 添加版本-->
	<div class="modal fade" tabindex="-1" role="dialog" id="versionModal">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">添加/修改版本</h4>
				</div>
				<div class="modal-body">
					<input class="form-control" id="id" type="hidden">	
					<div class="form-group">
						<label for="name">版本号：</label> 
						<input class="form-control" id="versionNum" placeholder="版本号">
					</div>
					<div class="form-group">
						<label for="type">是否强制升级：</label> 
						<select class="form-control" id="status" >
							<option value='0'>否</option>
							<option value='1' selected="selected">是</option>
						</select>
					</div>
					<div class="form-group" id="del_flag">
						<label for="type">启用状态：</label> 
						<select class="form-control" id="delFlag" >
							<option value='0'>启用</option>
							<option value='1'>删除</option>
						</select>
					</div>
					<div class="form-group">
						<label for="describe">版本描述：</label> <br/>
						<textarea rows="3" cols="50" id="content"  placeholder="版本描述" maxlength="500"></textarea>
					</div>
					<div class="form-group">
						<label for="name">下载地址：</label> 
						<input class="form-control" id="downloadUrl" placeholder="下载地址">
					</div>	
					<div class="form-group" id="operating_sys">
						<label for="operatSys">操作系统：</label> 
						<select class="form-control" id="operatSys" >
							<option value='0'>Android</option>
							<option value='1'>ios</option>
						</select>
					</div>					
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick="save()">保存</button>
				</div>
			</div>
		</div>
	</div>
	
	
	<script type="text/javascript" src="../scripts/menu.js"></script>
	<script type="text/javascript" src="../scripts/public.js"></script>
	<script type="text/javascript">
	$('.form_date').datetimepicker({
	    language: 'zh-CN',
	    weekStart: 1,
	    todayBtn: 1,
	    autoclose: 1,
	    todayHighlight: 1,
	    startView: 2,
	    minView: 2,
	    forceParse: 0,
	    startDate:new Date()
	});
	add = function(){
		$('#id').val("");
		$('#versionNum').val("");
		$('#status').val("");
		$('#del_flag').hide();
		$('#content').val("");
		$('#downloadUrl').val("");
		$("#status option:first").prop("selected", 'selected'); 
		$("#operatSys option:first").prop("selected", 'selected'); 
		$('#versionModal').modal('show');
	}
	save = function(){
		
		var id = $('#id').val();
		var versionNum = $('#versionNum').val();
		var status = $('#status').val();
		var delFlag = $('#delFlag').val();
		var content = $('#content').val();
		var downloadUrl = $('#downloadUrl').val();
		var operatSys = $('#operatSys').val();
		if(versionNum == '' || content == '' || downloadUrl==''){
			alert("请完善信息")
			return;
		}
		$.ajax({
			type:"post",
			url: '/jilu/backstage',
			data:{'action': id==''?'version_add':'version_update','id':id,'versionNum':versionNum,'status':status,'delFlag':delFlag,'content':content,'downloadUrl':downloadUrl, 'operatSys':operatSys},
			dataTyp:'json',
			success: function (json) {
	            	if(json.code=="0"){
	            		$('#versionModal').modal('hide');
	            		alert(json.desc);
	            		window.location.reload();
	            	}
	            	else{
	            		hideLoading();
	            		alert(json.desc);
	            	}
	            },
	            error: function () {
	                alert("数据加载失败");
	            }
		});
	}
	var total,totalPage; //总记录数，每页显示数，总页数
	var pageSize=15;
	getData=function(page) {
        $.ajax({
            type: 'POST',
            url: '/jilu/backstage',
            data: { 'page': page, 'pageSize': pageSize, 'action': 'version_get' },
            dataType: 'json',
            beforeSend: function () {
            	initLoading();
            	showLoading("正在加载数据，请稍候。。。");
            },
            success: function (json) {
            	//hideLoading();
            	RemoveLoading();
            	$("#list").empty();//清空数据区
            	var tr= "";
            	var list = json.data;
            	total = json.data.total; //总记录数
            	curPage = page; //当前页
                totalPage = Div(total, pageSize);
                $.each(list, function (index, array) { //遍历json数据列
					tr +="<tr><td><input type='checkbox' name='checkItem' /></td><td>"+array["versionId"] + "</td><td>"+ array["versionNum"] + "</td>";
					if(array["status"]==0)
						tr+="<td>否</td>";
					else if(array["status"]==1)
						tr+="<td>是</td>";
					if(array["delFlag"]==0)
						tr+="<td>启用</td>";
					else if(array["status"]==1)
						tr+="<td>未启用</td>";
					tr+="<td>" + DateFormat.prototype.format(new Date(array['created']*1000));
					tr+="</td><td>" + DateFormat.prototype.format(new Date(array['updated']*1000));
					tr+="</td><td>"+ array["content"] + "</td><td>"+array["downloadUrl"]+"</td>";
					if(array["operatSys"]==0)
						tr+="<td>Android</td>";
					else if(array["operatSys"]==1)
						tr+="<td>ios</td>";
					tr+="<td><a href='javascript:void(0)' class='btn btn-info btn-xs' onclick='info("+JSON.stringify(array)+")'>编辑</a></td></tr>";
                });
                $("#list").append(tr);
            },
            complete: function () { //生成分页条
            	if(totalPage>1)
        		{
            		console.log(total);
            		console.log(totalPage);
            		getPageBar();
        		}
            },
            error: function () {
                alert("数据加载失败");
            }
        });
    }
	info = function(array){
		$('#id').val(array["versionId"]);
		$('#versionNum').val(array["versionNum"]);
		$('#status').val(array["status"]);
		$("#del_flag").find("option[value='"+array["delFlag"]+"']").attr("selected",true); 
		$('#content').val(array["content"]);
		$('#downloadUrl').val(array["downloadUrl"]);
		$("#status").find("option[value='"+array["status"]+"']").attr("selected",true); 
		$("#operating_sys").find("option[value='"+array["operatSys"]+"']").attr("selected",true);
		$('#operating_sys').hide();
		$('#versionModal').modal('show');
	}
	
	$(document).ready(function() {
		getData(1);
	});

</script>
</body>
</html>