<html>
<head>
<title>后台管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<script type="text/javascript" src="../scripts/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../scripts/public.js"></script>
<script type="text/javascript" src="../scripts/islogin.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<link href="../bootstrap-3.3.5-dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="../bootstrap-3.3.5-dist/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<link href="../css/dashboard.css" rel="stylesheet" />
<link href="../css/menu.css" rel="stylesheet" />
</head>
<body>
	<nav id="main-top" class="navbar navbar-inverse navbar-fixed-top">
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2">
				<ul id="main-nav" class="main-nav nav nav-tabs nav-stacked" style="">
				</ul>
			</div>
			<div class="col-md-10">
				<h2 class="sub-header">后台用户管理</h2>
				
				
				<form role="form">
					<div class="form-inline form-group" id="a">
						<label for="loginNo">登录名：</label> <input class="form-control"
							id="loginNo" placeholder="登录名">
							<label for="adminpwd">密码：</label> <input class="form-control"
							id="password" placeholder="密码" type="password">
							<label for="userName">姓名：</label> <input class="form-control"
							id="userName" placeholder="姓名">
							<label for="role">角色：</label>
						<select class="form-control"  id="role1">
						  <option value="0" selected="selected">--请选择--</option>
						</select>
						<button type="button" class="btn btn-default" onclick="userAdd()"><span class="glyphicon glyphicon-plus"></span> 添加</button>
					</div>
					
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover">
							<thead>
								<tr>
									<th>登录名</th>
									<th>用户名称</th>
									<th>最后一次登录时间</th>
									<th width="180px">操作</th>
								</tr>
							</thead>
							<tbody id="list">
							</tbody>
						</table>
						<nav aria-label="Page navigation">
						  <ul class="pagination" id="pagecount">
						  </ul>
						</nav>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../scripts/menu.js"></script>
	<script type="text/javascript">
	
	$(document).ready(function(){
		selectRole();
		getData(1);
		
	});
	rolesGet=function(){
		$.ajax({
            type: 'POST',
            url: '/qydj/backstage',
            data: { 'loginNo': loginNo ,'password': password,'userName': userName ,'action': 'admin_user_add' },
            dataType: 'json',
            beforeSend: function () {
                //$("#dvList ul").append("<li id='loading'>loading/static.</li>");//显示加载动画
            },
            success: function (json) {
            	if(json.code=="0")
            		window.location.reload();
            	else
            		alert(json.desc);
            },
            error: function () {
                alert("数据加载失败");
            }
        });
	}
	selectRole=function(){
		$.ajax({
            type: 'POST',
            url: '/jilu/backstage?action=role_list',
            dataType: 'json',
            success: function (json) {
            	$.each(json.data, function (index, array) {
					document.getElementById("role1").options.add(new Option(array['roleName'],array['roleId']));
            	});
            },
            error: function () {
                alert("数据加载失败");
            }
        });
	}
	getData=function(page) {
        $.ajax({
            type: 'POST',
            url: '/jilu/backstage?action=sysuser_list',
            data: { 'page': page, 'pageSize': pageSize},
            dataType: 'json',
            beforeSend: function () {
                //$("#dvList ul").append("<li id='loading'>loading/static.</li>");//显示加载动画
            },
            success: function (json) {
            	$("#list").empty();//清空数据区
            	var tr= "";
            	var list = json.data.list;
            	total = json.data.total; //总记录数
            	curPage = page; //当前页
                totalPage = Div(total, pageSize);
                $.each(list, function (index, array) { //遍历json数据列
                	var remark="";
                	if(array["lastLoginTime"]=="")
                		remark="还未登录";
                	else
                		remark=getLocalTime(array['lastLoginTime']);
//                 	if(flag=="1"){
                		tr +="<tr><td>" + array['loginNo'] + "</td><td>" + array['userName'] + "</td><td>" + remark + "</td><td><a href=\"javascript:void(0)\" class=\"btn btn-sm btn-warning\" onclick=\"deleteData("+array['adminId']+")\">删除</a></td></tr>";
//                 	}
//                 	else{
//                 		tr +="<tr><td><input type=\"checkbox\" name=\"checkItem\" /></td><td>" + array['loginNo'] + "</td><td>" + array['userName'] + "</td><td>" + remark + "</td><td></td></tr>";
//                 	}
                });
                
                $("#list").append(tr);
            },
            complete: function () { //生成分页条
            	if(totalPage>1)
        		{
            		getPageBar();
        		}else{
        			$("#pagecount").empty();
        		}
            },
            error: function () {
                alert("数据加载失败");
            }
        });
    }
	
	getData(1);
	
	userAdd=function(){
		var loginNo = $("#loginNo").val();
		var password = $("#password").val();
		var userName = $("#userName").val();
		var roleId = $("#role1").val();
		if(roleId=="0")
			alert("请选择用户角色");
 		else{
			if($.trim(loginNo)!=""&&$.trim(password)!=""){
				$.ajax({
		            type: 'POST',
		            url: '/jilu/backstage?action=sysuser_add',
		            data: { 'loginNo': loginNo ,'password': password,'userName': userName ,'roleId': roleId},
		            dataType: 'json',
		            beforeSend: function () {
		                //$("#dvList ul").append("<li id='loading'>loading/static.</li>");//显示加载动画
		            },
		            success: function (json) {
		            	if(json.code=="0")
		            		window.location.reload();
		            	else
		            		alert(json.desc);
		            },
		            error: function () {
		                alert("数据加载失败");
		            }
		        });
			}
		}
	}
	deleteData = function(id){
		if(confirm("确定要删除这条数据吗？")){
			$.ajax({
	            type: 'POST',
	            url: '/jilu/backstage?action=sysuser_del',
	            data: { 'adminId': id},
	            dataType: 'json',
	            success: function (json) {
	            	window.location.reload();
	            },
	            error: function () {
	                alert("数据加载失败");
	            }
	        });
		}
	}
</script>
</body>
</html>