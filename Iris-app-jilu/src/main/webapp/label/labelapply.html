<!DOCTYPE html>
<html>
<head>
<title>后台管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<script type="text/javascript" src="../scripts/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../scripts/public.js"></script>
<script type="text/javascript" src="../scripts/mydate.js"></script>
<script type="text/javascript" src="../scripts/islogin.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<link href="../bootstrap-3.3.5-dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="../bootstrap-3.3.5-dist/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<link href="../css/dashboard.css" rel="stylesheet" />
<link href="../css/menu.css" rel="stylesheet" />
</head>
<body>
	<nav id="main-top" class="navbar navbar-inverse navbar-fixed-top">
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2">
				<ul id="main-nav" class="main-nav nav nav-tabs nav-stacked" style="">
				</ul>
			</div>
			<div class="col-md-10">
			<h2 class="sub-header">申请标签列表</h2>
				<form role="form">
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover">
							<thead>
								<tr>
									<th><input type="checkbox" id="checkAll" name="checkAll" /></th>
									<th>购买人</th>
									<th>标签数量</th>
									<th>收件人</th>
									<th>收件地址</th>
									<th>联系电话</th>
									<th>申请购买时间</th>
									<th width="180px">操作</th>
								</tr>
							</thead>
							<tbody id="list">
							</tbody>
						</table>
						<nav aria-label="Page navigation">
						  <ul class="pagination" id="pagecount">
						  </ul>
						</nav>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../scripts/menu.js"></script>
	<script type="text/javascript">
	$(document).ready(function() {
		getData(1);
	});
	getData=function(page) {
        $.ajax({
            type: 'POST',
            url: '/jilu/backstage',
            data: { 'page': page, 'pageSize': pageSize, 'action': 'label_list',"status":0},
            dataType: 'json',
            beforeSend: function () {
            	initLoading();
            	showLoading("正在加载数据，请稍候。。。");
            },
            success: function (json) {
            	hideLoading();
            	RemoveLoading();
            	$("#list").empty();//清空数据区
            	var tr= "";
            	var list = json.data.list;
            	total = json.data.total; //总记录数
            	curPage = page; //当前页
                totalPage = Div(total, pageSize);
                $.each(list, function (index, array) { //遍历json数据列
               		tr +="<tr><td><input type='checkbox' name='checkItem' /></td><td>" + array['merchantName'] + 
               		"</td><td>" + array['count'] + "</td><td>" + array['sendName'] + "</td><td>" + array['sendAddress'] + "</td><td>" + array['sendMobile'] + "</td><td>" + array['created'] + "</td>"+
               		"<td><a href='javascript:void(0)' class='btn btn-info btn-xs' onclick='sendLabel("+array['goodsId']+")'>发货</a>"+
               		"</td></tr>";
                });
                
                $("#list").append(tr);
            },
            complete: function () { //生成分页条
            	if(totalPage>1)
        		{
            		getPageBar();
        		}else{
        			$("#pagecount").empty();
        		}
            },
            error: function () {
                alert("数据加载失败");
            }
        });
    }
	sendLabel = function(id){
		$.ajax({
			type:"post",
			url: '/jilu/backstage',
			data:{'action':'send_label','id':id},
			dataTyp:'json',
			 success: function (json) {
	            	if(json.code=="0"){
	            		hideLoading();
	            		getData(curPage)
	            	}
	            	else{
	            		hideLoading();
	            		alert(json.desc);
	            	}
	            },
	            error: function () {
	                alert("数据加载失败");
	            }
		});
	}
</script>
</body>
</html>