<!DOCTYPE html>
<html>
<head>
<title>后台管理系统</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<script type="text/javascript" src="../scripts/public.js"></script>
<script type="text/javascript" src="../scripts/mydate.js"></script>
<script type="text/javascript" src="../scripts/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../scripts/islogin.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
<script type="text/javascript" src="../bootstrap-3.3.5-dist/js/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
<link href="../bootstrap-3.3.5-dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="../bootstrap-3.3.5-dist/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<link href="../css/dashboard.css" rel="stylesheet" />
<link href="../css/menu.css" rel="stylesheet" />
</head>
<body>
	<nav id="main-top" class="navbar navbar-inverse navbar-fixed-top">
	</nav>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2">
				<ul id="main-nav" class="main-nav nav nav-tabs nav-stacked" style="">
				</ul>
			</div>
			<div class="col-md-10">
			<h2 class="sub-header">标签列表</h2>
				<form role="form">
					<div class="form-inline form-group">
						<button type="button" class="btn btn-default" onclick="add()"><span class="glyphicon glyphicon-plus"></span> 添加</button>
					</div>
					
					<div class="table-responsive">
						<table class="table table-striped table-bordered table-hover">
							<thead>
								<tr>
									<th><input type="checkbox" id="checkAll" name="checkAll" /></th>
									<th>号码</th>
									<th>价格（吉币）</th>
									<th width="180px">操作</th>
								</tr>
							</thead>
							<tbody id="list">
							</tbody>
						</table>
						<nav aria-label="Page navigation">
						  <ul class="pagination" id="pagecount">
						  </ul>
						</nav>
					</div>
					
				</form>
			</div>
		</div>
	</div>
	<!-- 添加标签-->
	<div class="modal fade" tabindex="-1" role="dialog" id="labelModal">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">添加/修改标签</h4>
				</div>
				<div class="modal-body">
					<input class="form-control" id="id" type='hidden'>	
					<div class="form-group">
						<label for="labelNum">标签号码：</label> 
						<input class="form-control" id="labelNum" placeholder="标签号码">
					</div>
					<div class="form-group">
						<label for="price">标签价格（吉币）：</label> <br/>
						<input class="form-control" id="price" placeholder="标签价格">
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick="save()">保存</button>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript" src="../scripts/menu.js"></script>
	<script type="text/javascript">
	$('.form_date').datetimepicker({
	    language: 'zh-CN',
	    weekStart: 1,
	    todayBtn: 1,
	    autoclose: 1,
	    todayHighlight: 1,
	    startView: 2,
	    minView: 2,
	    forceParse: 0,
	    startDate:new Date()
	});

	$(document).ready(function(){
		getData(1);
		$("#checkAll").click(function(){  
	        //实现反选功能  
	        $('[name=checkItem]:checkbox').each(function(){  
	            this.checked=!this.checked;  
	        });
	    });
	});
	
	$(document).on("click", "#pagecount li a", function() {
        var rel = $(this).attr("rel");
        if (rel) {
            getData(rel);
        }
	});
	
	var total,totalPage; //总记录数，每页显示数，总页数
	var pageSize=15;
	getData=function(page) {
        $.ajax({
            type: 'POST',
            url: '/jilu/backstage',
            data: { 'page': page, 'pageSize': pageSize, 'action': 'label_list' },
            dataType: 'json',
            beforeSend: function () {
            	initLoading();
            	showLoading("正在加载数据，请稍候。。。");
            },
            success: function (json) {
            	hideLoading();
            	RemoveLoading();
            	$("#list").empty();//清空数据区
            	var tr= "";
            	var list = json.data.list;
            	total = json.data.total; //总记录数
            	curPage = page; //当前页
                totalPage = Div(total, pageSize);
                $.each(list, function (index, array) { //遍历json数据列
               		tr +="<tr><td><input type='checkbox' name='checkItem' /></td><td>" + array['labelNum'] + 
               		"</td><td>" + array['price'] + "</td><td><a href='javascript:void(0)' class='btn btn-info btn-xs' onclick='info("+array['id']+")'>编辑</a>"+
               		"&nbsp;&nbsp;&nbsp;&nbsp;<a href='javascript:void(0)' class='btn btn-danger btn-xs' onclick='del("+array['id']+")'>删除</a>"+
               		"</td></tr>";
                });
                
                $("#list").append(tr);
            },
            complete: function () { //生成分页条
            	if(totalPage>1)
        		{
            		//getPageBar();
        		}
            },
            error: function () {
                alert("数据加载失败");
            }
        });
    }
	getPageBar=function() {
        //页码大于最大页数
        if (curPage > totalPage) curPage = totalPage;
        //页码小于1
        if (curPage < 1) curPage = 1;
        pageStr = "<li class='disabled'><a href='javascript:void(0)'>共" + total + "条</a></li><li class='disabled'><a href='javascript:void(0)'>" + curPage + "/" + totalPage + "</a></li>";
        //如果是第一页
        if (curPage == 1) {
            pageStr += "<li class='disabled'><a href='javascript:void(0)'>首页</a></li><li class='disabled'><a href='javascript:void(0)'>上一页</a></li>";
        }
        else {
            pageStr += "<li><a href='javascript:void(0)' rel='1'>首页</a></li><li><a href='javascript:void(0)' rel='" + (curPage - 1) + "'>上一页</a></li>";
        }
        //如果是最后页
        if (curPage >= totalPage) {
            pageStr += "<li class='disabled'><a href='javascript:void(0)'>下一页</a></li><li class='disabled'><a href='javascript:void(0)'>尾页</a></li>";
        }
        else {
            pageStr += "<li><a href='javascript:void(0)' rel='" + (parseInt(curPage) + 1) + "'>下一页</a></li><li><a href='javascript:void(0)' rel='" + totalPage + "'>尾页</a></li>";
        }
        $("#pagecount").html(pageStr);
    }
	add = function(){
		$('#labelNum').val("");
		$('#price').val("");
		$('#labelModal').modal('show');
	}
	info = function(id){
		$.ajax({
			type:"post",
			url: '/jilu/backstage',
			data:{'action': 'label_info','id':id},
			dataTyp:'json',
			success: function (json) {
            	if(json.code=="0"){
            		var label = json.data;
            		$('#id').val(label.id);
            		$('#labelNum').val(label.labelNum);
            		$('#price').val(label.price);
            	}
            	else{
            		alert(json.desc);
            	}
	        },
            error: function () {
                alert("数据加载失败");
            }
		});
		$('#labelModal').modal('show');
	}
	del = function(id){
		$.ajax({
			type:"post",
			url: '/jilu/backstage',
			data:{'action':"label_delete",'id':id},
			dataTyp:'json',
			 success: function (json) {
	            	if(json.code=="0"){
	            		alert(json.desc);
	            		window.location.reload();
	            	}
	            	else{
	            		hideLoading();
	            		alert(json.desc);
	            	}
	            },
	            error: function () {
	                alert("数据加载失败");
	            }
		});
	}
	save = function(){
		var id = $('#id').val()
		var price = $('#price').val();
		var labelNum = $('#labelNum').val();
		if(price == '' || labelNum == ''){
			alert("请完善信息")
			return;
		}
		$.ajax({
			type:"post",
			url: '/jilu/backstage',
			data:{'action': id==''?'label_add':'label_edit','id':id,'price':price,'labelNum':labelNum},
			dataTyp:'json',
			 success: function (json) {
	            	if(json.code=="0"){
	            		hideLoading();
	            		window.location.reload();
	            	}
	            	else{
	            		hideLoading();
	            		alert(json.desc);
	            	}
	            },
	            error: function () {
	                alert("数据加载失败");
	            }
		});
	}
</script>
</body>
</html>