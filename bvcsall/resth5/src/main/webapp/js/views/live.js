requirejs.config({shim:{"../libs/jquery.qqFace":["../libs/jquery-2.1.4"]}}),define(["../libs/jquery-2.1.4","head","../common/info","../common/aler","../service/service","../common/share","../common/browse"],function(e,i,o,t,n,a,s){var d=o.getPicPerfix(),r=o.getRequestPrefix(),l=$("#chaturl").val(),c=$("#roomId").val(),p=$("#videoId").val(),v=(o.getCookie("uid"),$("#roomCreatorId").val()),h=o.getCookie("access_token"),u=0,m=-1,w=3e3,f=$(window).height();$(".shareBtn").attr("data-videoid",c);var g=(document.getElementById("chatContent"),document.getElementById("video"),$("#reviewURL").val()),y=r.split("//"),B=y[1].split("/"),x=B[0],k=window.location.href;o.setCookie("backurl",encodeURIComponent(k),7);var b=_czc||[];b.push(["_setAccount","1259916005"]);var I;I=""==o.getCookie("channel")?"h5":"h5-"+o.getCookie("channel");var L=$("#shareImg").val(),_=$("#shareTitle").val(),E=$("#shareText").val(),U=$("#timestamp").val(),R=$("#noncestr").val(),C=$("#signature").val(),P={init:function(){if(wx.config({debug:!1,appId:"wx9c59e9a110527d17",timestamp:U,nonceStr:R,signature:C,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]}),wx.ready(function(){wx.onMenuShareTimeline({title:_,link:"",imgUrl:d+L,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:_,desc:E,link:"",imgUrl:d+L,type:"",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareQQ({title:_,desc:E,link:"",imgUrl:d+L,success:function(){},cancel:function(){}}),wx.onMenuShareWeibo({title:_,desc:E,link:"",imgUrl:d+L,success:function(){},cancel:function(){}}),wx.onMenuShareQZone({title:_,desc:E,link:"",imgUrl:d+L,success:function(){},cancel:function(){}})}),s.versions.isWx&&""==h)return void(window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx9c59e9a110527d17&redirect_uri=http%3a%2f%2f"+x+"%2fresth5%2fthirdPart%2fwechatCallback&response_type=code&scope=snsapi_userinfo&state=STATE&connect_redirect=1#wechat_redirect%3fregPlatform="+I);""==$("#videoURL").val()&&""==$("#reviewURL").val()?($(".liveEnd").show(),$(".playBtn").hide(),$(".main").css("position","inherit"),n.getRoomById(c).done(function(e){$(".maxAccessNumber").text("总观看人数："+e.result.maxAccessNumber),$(".praiseNumber").text(e.result.praiseNumber),$("#timestamp1").text(P.timeFn(e.result.duration))})):""==$("#videoURL").val()&&""!=$("#reviewURL").val()?($(".main").css("z-index","999"),P.reViewFn()):""!=$("#videoURL").val()&&P.addVideo(),$(".videoBox").css("height",$(window).height()),o.personalPortrait(d,$(".userPortrait-1")),o.personalPortrait(d,$(".userPortrait"));$("#chatContent ul").height();$(window).scroll(function(){o.lazyPicLoad($(".videoListBox li a img")),o.lazyPicLoad($(".hotUesrPic"))}),s.versions.isWx?P.attenFn():P.showBox(),$(".joinBtn").on("click",function(){b.push(["_trackEvent","下载","我玩统计直播下载Top","","",".joinBtn"])}),$(".bottomDownload").on("click",function(){b.push(["_trackEvent","下载","我玩统计直播下载Bottom","","",".bottomDownload"])}),$(".attenBtn").on("click",function(){b.push(["_trackEvent","关注","我玩统计直播关注","关注埋点","",".attenBtn"])}),P.roomList(),P.jumpDownload()},addVideo:function(){if(s.versions.ios)if(320!=$(window).width()||s.versions.isQQ){s.versions.isSafari?$(".loading").hide():s.versions.isWeiBo?$(".loading").hide():$(".loading").show();var e='<video id="video" class="video-js vjs-default-skin" autoplay="autoplay" x-webkit-playsinline webkit-playsinline="controls" width="100%"><source src="'+$("#videoURL").val()+'" type="application/x-mpegURL"></video>';$(".videoBox").append(e);var i=document.getElementById("video");i.addEventListener("play",function(){$(".userPortrait-1").hide(),$(".loading").hide(),$("#playBtn").hide()}),i.addEventListener("playing",function(){$(".userPortrait-1").hide(),$(".loading").hide(),$("#playBtn").hide();var e=$("video").height(),i=$(window).height();i>e&&$(this).css("margin-top",(i-e)/2)}),i.addEventListener("seeking",function(){}),i.addEventListener("seeked",function(){}),i.addEventListener("stalled",function(){}),i.addEventListener("canplaythrough",function(){}),i.addEventListener("ratechange",function(){}),i.addEventListener("durationchange",function(){}),s.versions.isWeiBo||s.versions.webApp?($(".playBtn").show(),P.playFun()):$(".playBtn").hide()}else{$(".loading").hide();var o=document.getElementById("playBtn");document.getElementById("videoBox");o.style.display="block";var e='<video id="video" class="video-js vjs-default-skin" autoplay="autoplay" x-webkit-playsinline webkit-playsinline="controls"><source src="'+$("#videoURL").val()+'" type="application/x-mpegURL"></video>';$(".videoBox").append(e);var i=document.getElementById("video");i.addEventListener("playing",function(){var e=$("video").height(),i=$(window).height();i>e&&$(this).css("margin-top",(i-e)/2)}),o.addEventListener("click",function(){i.play()}),i.addEventListener("playing",function(){$(".userPortrait-1").hide(),$(".loading").hide(),o.style.display="none"}),i.addEventListener("webkitendfullscreen",function(){i.pause(),$(".main").show(),$(".userPortrait-1").show(),o.style.display="block"},!1)}else if(s.versions.android){$(".loading").hide();var e='<video id="video" class="" autoplay="autoplay" width="100%" preload="auto" x-webkit-playsinline webkit-playsinline="controls"><source src="'+$("#videoURL").val()+'" type="application/x-mpegURL"></video>';$(".videoBox").append(e),$("#video").css({position:"absolute",top:"0","z-index":"-999"});var t=videojs("video");videojs("video").ready(function(){var e=this;e.play(),e.cancelFullScreen(),e.ended&&$("#video_html5_api").hide()});$(window).height();$("#video").css("min-height","400px"),$("#video_html5_api").siblings().hide(),$("#video_html5_api").attr("poster",d+$("#posterURL").val()),$("#video_html5_api").css("width","100%"),$("#video_html5_api").hide(),$(".playBtn").show(),$(".playBtn").one("click",function(){$("#video_html5_api").show(),$("#video").css("z-index","-9999"),t.play(),$(".userPortrait-1").hide(),$(".playBtn").hide(),$("#video img").hide()})}},imgLoadCompleted:function(e){e?($("#video").css({height:f,overflow:"hidden"}),$("#poster").css({position:"absolute",left:"50%","margin-left":-$("#poster").width()/2,"max-width":"inherit"})):$("#poster").css({position:"absolute",left:"50%","margin-left":-$("#poster").width()/2,"max-width":"inherit"})},playFun:function(){var e=document.getElementById("playBtn"),i=document.getElementById("video");e.addEventListener("click",function(){i.play(),e.style.display="none"},!1),i.addEventListener("webkitendfullscreen",function(){i.pause(),e.style.display="block"},!1),i.played||(e.style.display="block"),i.paused&&(e.style.display="block")},showBox:function(){$(".attenBtn").on("click",function(){b.push(["_trackEvent","关注","我玩统计直播关注","关注埋点","",".attenBtn"]);var e="<p>下载LIVE关注ta</p><p>ta的直播会在第一时间通知你哦</p>";$(".words").append(e),$(".words p").css("color","#9fbc16"),$(".showBox").show(),$(".bgBox").show(),$(".showBox img.imgBox").attr("src","/resth5/img/personalBg/attentionBox.png"),$(".closeBtn").on("click",function(){$(".showBox").hide(),$(".bgBox").hide(),$(".words p").remove(),$(".showBox img.imgBox").attr("src","")})})},websorket:function(){var e=null;if("WebSocket"in window)try{e=new WebSocket(l+"?roomId="+c)}catch(i){console.log("聊天系统未连接:"+l)}else"MozWebSocket"in window?e=new MozWebSocket(l+"?roomId="+c):console.log("not support");e.onmessage=function(e){var i=JSON.parse(e.data);document.getElementById("video");if("1001"==i.childCode){var t='<li class="face"><span  class="color'+Math.floor(2*Math.random()+1)+'">'+i.senderName+":</span>"+i.content+"</li>";$("#chatContent ul").append(t),o.faceFn($(".face")),P.swiperFlag("true")}else if("0006"==i.childCode){P.addVideo(),$("#video,.funPerson,.audienceImg,#chatContent,.openApp").show();var t="<li>"+i.content+"</li>";$("#chatContent ul").append(t),P.swiperFlag("true"),$(".liveEnd").hide()}else if("2002"==i.childCode)$("#video,.funPerson,.audienceImg,.playBtn,#chatContent,.openApp").hide(),$(".liveEnd").show(),$("#video").remove(),$(".bottomDownload").show(),n.getRoomById(c).done(function(e){$(".maxAccessNumber").text("总观看人数："+e.result.maxAccessNumber+"人")});else if("0001"==i.childCode){var t="<li>"+i.extra.name+"来了</li>";$("#chatContent ul").append(t),P.swiperFlag("true")}else if("0002"==i.childCode)$(".onlineCount").text(i.extra.onlineNumber),$(".allCount").text(i.extra.maxAccessNumber);else if("0009"==i.childCode||"2005"==i.childCode)$("#video,.funPerson,.audienceImg,.playBtn,#chatContent,.openApp").hide(),$("#video").remove(),$(".loading").hide(),$(".liveEnd").show(),$(".bottomDownload").show(),n.getRoomById(c).done(function(e){$(".maxAccessNumber").text("总观看人数："+e.result.maxAccessNumber+"人"),$(".praiseNumber").text(e.result.praiseNumber)});else if("2001"==i.childCode)$("#video,.funPerson,.audienceImg,.playBtn,#chatContent,.openApp").show(),$(".liveEnd").hide();else if("0005"==i.childCode)$(".audienceImg ul li img").each(function(){$(this).attr("src")==d+i.extra.pic&&$(this).parent().remove()});else if("2003"==i.childCode){var t=$("<li>"+i.content+"</li>");$("#chatContent ul").append(t)}else if("2004"==i.childCode)if(s.versions.ios)$("#video").attr("src",$("#videoURL").val());else if(s.versions.android){$("#video").remove();var a='<video id="video" class="" autoplay="autoplay" width="100%" preload="auto"><source src="'+$("#videoURL").val()+'" type="application/x-mpegURL"></video>';$(".videoBox").append(a);var r=videojs("video");videojs("video").ready(function(){var e=this;e.play(),e.cancelFullScreen(),e.ended&&$("#video_html5_api").hide()}),$("#video_html5_api").hide(),$("#video").css("min-height","400px"),$("#video").append('<img width="100%" height="'+f+'" src="'+d+$("#posterURL").val()+'" >'),$("#video_html5_api").attr("poster",d+$("#posterURL").val()),$("#video_html5_api").css("width","100%"),$(".playBtn").show(),$(".playBtn").on("click",function(){$("#video_html5_api").show(),$("#video").css("z-index","-9999"),r.play(),$(".playBtn").hide(),$("#video img").hide()})}},e.onclose=function(e){console.log("聊天服务器已关闭，请重新登陆")},e.onopen=function(i){u=setInterval(function(){P.keepalive(e)},3e4)},e.onerror=function(e){}},swiperFlag:function(e){var i=$("#chatContent ul").height();"true"==e&&$("#chatContent").scrollTop(i)},keepalive:function(e){var i=new Date;-1!=m&&i.getTime()-m>w?console.log("服务器没有响应."):(console.log("连接正常."),0==e.bufferedAmount&&e.send(JSON.stringify({childCode:"0004",code:"000",roomId:c})))},roomList:function(){var e=1,i=18,o=1,t=$(".videoListBox ul");n.getLiveAndRecordList(e,i,o).done(function(e){P.makeLiveList(e.result,t)})},makeLiveList:function(e,i){if(""==e.liveList&&""==e.backList)$(".hotRecommend,.reBotton").hide(),$(".liveEnd").css("height",$(window).height()-99);else{var t=e.liveList;if($.each(t,function(e,o){var t;t=1==o.anchorVstat?'<em class="userV1"></em>':2==o.anchorVstat?'<em class="userV2"></em>':3==o.anchorVstat?'<em class="userV3"></em>':"";var n;if(n=o.title?o.title:o.anchorName,c!=o.id){if(o.onlineNumber>1e4)var a=(o.onlineNumber/1e4).toFixed(1)+"万人";else var a=o.onlineNumber+"人";var s='<li><a href="javascript:void(0)"><img data-userPic="'+o.roomPic+'" data-roomId="'+o.id+'"src="'+r+'/img/personalBg/personalBg.jpg" class="hotPic"></a><span class="nickName" style="color:#999999;">'+o.anchorName+'</span><span style="float:right;color:#f0be9f;">'+a+"</span></li>";i.append(s)}}),t.length<18){var n=e.backList;$.each(n,function(e,o){var t;t=1==o.anchorVstat?'<em class="userV1"></em>':2==o.anchorVstat?'<em class="userV2"></em>':3==o.anchorVstat?'<em class="userV3"></em>':"";var n;if(n=o.title?o.title:o.anchorName,c!=o.liveNoticeId){var a='<li><a href="javascript:void(0)"><img data-userPic="'+o.videoPic+'" data-roomId="'+o.liveNoticeId+'"src="" class="hotPic"></a></li>';i.append(a)}})}var a=.98*$("body").width()/2*.985;console.log(a),$(".hotRecommend .videoListBox ul li a img").css("height",a),$(".hotRecommend,.bottomDownload").show(),o.personalPortrait(d,$(".hotPic")),o.personalPortrait(d,$(".hotUesrPic")),$(".videoListBox ul li a").on("click",function(){window.location.href=r+"/live/shareLive?roomId="+$(this).find("img").attr("data-roomId")})}},shareFn:function(){var e=$(".shareBtn").attr("data-name"),i=$(".shareBtn").attr("data-desc"),o=d+$(".shareBtn").attr("data-videopic"),t=$("#roomId").val(),n=$(".shareBtn").attr("data-userId"),s=1;a.init(e,i,o,t,n,s)},jump:function(e){var i=$("#roomId").val();s.versions.ios?s.versions.isWx||s.versions.isWeiBo?$(".skyBox").show():""!=$("#reviewURL").val()?e.attr("href","wopai://reviewId="+p):window.location.href="wopai://roomid="+i:s.versions.android?s.versions.isWx||s.versions.isWeiBo?$(".skyBox-anz").show():""!=$("#reviewURL").val()?window.location.href="com.busap.myvideo://main/openwith?reviewId="+p+"&type=12":window.location.href="com.busap.myvideo://main/openwith?roomId="+c+"&type=11":window.location.href="http://www.wopaitv.com#cnzz_name=loading&cnzz_from=videoDetailDownload",$(".skyBox,.skyBox-anz").click(function(){$(this).hide()})},jumpNew:function(e){var i=$("#roomId").val();s.versions.ios?""!=$("#reviewURL").val()?window.location.href="wopai://reviewId="+p:window.location.href="wopai://roomid="+i:s.versions.android?""!=$("#reviewURL").val()?window.location.href="com.busap.myvideo://main/openwith?reviewId="+p+"&type=12":window.location.href="com.busap.myvideo://main/openwith?roomId="+c+"&type=11":window.location.href="http://www.wopaitv.com#cnzz_name=loading&cnzz_from=videoDetailDownload"},reViewFn:function(){var e=($("#reviewVideoURL").val(),$("#reviewVideoDuration").val());if($("#videoDuration").text("观看人数："+e+"人"),$(".playBtn").show(),s.versions.ios){var i='<video id="video1" class="video-js vjs-default-skin" autoplay="autoplay" x-webkit-playsinline webkit-playsinline><source src="'+g+'" type="application/x-mpegURL"></video>',o='<img id="poster" height="'+$(window).height()+'" src="'+d+$("#posterURL").val()+'">',t=document.getElementById("playBtn"),n=document.getElementById("videoBox");t.style.display="block",t.addEventListener("click",function(){$(".loading").show(),$(".videoBox").append(i),$("#video1").css("width",$(window).width());var e=document.getElementById("video1");$("#poster").remove(),t.style.display="none",e.style.display="block",e.play(),e.addEventListener("webkitendfullscreen",function(){n.innerHTML=o,e.style.display="none",$(".main").show(),t.style.display="block"},!1),e.addEventListener("playing",function(){$(".userPortrait-1").hide(),$(".loading").hide(),$("#playBtn").hide();var e=$("video").height(),i=$(window).height();i>e&&$(this).css("margin-top",(i-e)/2)})})}else if(s.versions.android){var a=$(window).height();$("#video1").css("min-height","400px"),$(".videoBox").append('<img id="poster" height="'+a+'" src="'+d+$("#posterURL").val()+'">'),$("#video1_html5_api").attr("poster",d+$("#posterURL").val()),$("#video1_html5_api").css("width","100%"),$("#video1_html5_api").hide(),$(".playBtn").show(),$(".playBtn").on("click",function(){var e='<video id="video1" class="" autoplay="autoplay" width="100%" preload="auto"><source src="'+g+'" type="application/x-mpegURL"></video>';$(".videoBox").append(e),$("#video1").css({position:"absolute",top:"0","z-index":"-999"}),$("#video1_html5_api").show().css("width","100%"),$("#video").css("z-index","-9999"),$(".playBtn").hide(),$("#poster").hide();videojs("video1");videojs("video1").ready(function(){var e=this;e.play(),e.cancelFullScreen(),e.ended&&$("#video_html5_api").hide()}),$("#video1_html5_api").siblings().remove()}),document.getElementById("poster").onload=function(){var e=1;P.imgLoadCompleted(e)};document.getElementById("poster")}},attenFn:function(){var e=v;n.isAttention(e).done(function(e){var i=e.result;if("0"==i){var o=v,a="h5";$(".atten em").click(function(){n.addAttention(o,a,i).done(function(e){1==e.result&&($(".atten em").remove(),t.alertMsg("关注成功！"))})})}else $(".atten em").remove()}).fail(function(e){("401"==e.code||"400_5"==e.code||"503"==e.code)&&(o.clearCookie("uid"),o.clearCookie("access_token"),window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx9c59e9a110527d17&redirect_uri=http%3a%2f%2f"+x+"%2fresth5%2fthirdPart%2fwechatCallback&response_type=code&scope=snsapi_userinfo&state=STATE&connect_redirect=1#wechat_redirect%3fregPlatform="+I)})},timeFn:function(e){if(e/36e5>1){if(parseInt(e/36e5)>10)var i=parseInt(e/36e5);else var i="0"+parseInt(e/36e5);if(e%36e5/6e4>1){if(parseInt(e%36e5/6e4)>10)var o=parseInt(e%36e5/6e4);else var o="0"+parseInt(e%36e5/6e4);if(e%36e5%6e4>1)if(parseInt(e%36e5%6e4/1e3)>10)var t=parseInt(e%36e5%6e4/1e3);else var t="0"+parseInt(e%36e5%6e4/1e3)}else{var i="00";if(e/6e4>1){if(parseInt(e%6e4)>10)var o=parseInt(e%6e4);else var o="0"+parseInt(e%6e4);if(e%6e4/1e3>1)if(parseInt(e%6e4%1e3)>10)var t=parseInt(e%6e4%1e3);else var t="0"+parseInt(e%6e4%1e3)}else{var o="00";if(e/1e3>10)var t=e/1e3;else var t="0"+e/1e3}}}else{var i="00";if(e/6e4>1){if(parseInt(e/6e4)>10)var o=parseInt(e/6e4);else var o="0"+parseInt(e/6e4);if(e%6e4/1e3>1)if(e%6e4/1e3>10)var t=parseInt(e%6e4/1e3);else var t="0"+parseInt(e%6e4/1e3)}else{var o="00";if(e/1e3>10)var t=parseInt(e/1e3);else var t="0"+parseInt(e/1e3)}}return i+":"+o+":"+t},getRoomUserList:function(e){var i=$(".audienceImg ul");$.each(e,function(e,o){var t=$('<li><img src="'+d+o.pic+'"></li>');i.prepend(t),$(".audienceImg ul").width(($(".audienceImg").children().children("li").width()+10)*$(".audienceImg").children().children("li").length)})},getRoomUser:function(e,i,o){n.getRoomUser(e,i,o).done(function(e){P.getRoomUserList(e.result)})},jumpDownload:function(){$("body").on("touchstart",".bottomDownload,.downloadBtn,.joinBtn",function(e){e.preventDefault(),s.versions.ios&&(s.versions.isWeiBo?$(".skyBox").show():window.location.href="https://itunes.apple.com/us/app/wo-pai-wo-jiu-shi-zhu-jiao/id1077305226?ls=1&mt=8"),s.versions.android&&(s.versions.isWeiBo?$(".skyBox-anz").show():window.location.href=o.appDownUrl),s.versions.isWx&&(window.location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.busap.myvideo&g_f=991653")}),$(".skyBox,.skyBox-anz").click(function(){$(this).hide()}),$(".bottomDownload .openwopai").click(function(){s.versions.ios||s.versions.android||(window.location.href=o.appDownUrl)})}};P.init()});