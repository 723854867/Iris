define(["../libs/jquery-2.1.4","head","../common/info","../common/aler","../service/service","../common/share","../common/browse"],function(t,e,n,o,i,a,s){var r=n.getPicPerfix(),c=n.getRequestPrefix(),d=n.getCookie("uid"),l=(n.getCookie("access_token"),$("#roomId").val());$(".shareBtn").attr("data-videoid",l);var v={init:function(){if($(window).scroll(function(){n.lazyPicLoad($(".videoListBox li a img")),n.lazyPicLoad($(".hotUesrPic"))}),parseInt($(".praise span").text())>=1e4){var t=(parseInt($(".praise span").text())/1e4).toFixed(1);$(".praise span").text(t+"万")}n.personalPortrait(r,$(".userPortrait-1")),n.videoInfo(r,$(".videoPic")),v.roomList(),$(function(){$(".playBox").css("height",$(".playBox").width()),$(".blackBox").css("height",$(".playBox").width())}),$(".blackBox").click(function(){_czc.push(["_trackEvent","livePlay","播放按钮"])}),$("div").delegate(".go-user-page,.userPortrait-1","click",function(){window.location.href="http://wopaitv.com",_czc.push(["_trackEvent","liveUserHead","直播人头像"])}),$(".canPlay,.commit em").on("click",function(){v.jump($(this))}),$(".shareBtn").click(function(){v.shareFn(),_czc.push(["_trackEvent","liveShare","分享按钮"])});var e=n.getCookie("sign");"bbb"==e&&($(".showBox").show(),$(".bgBox").show(),$(".showBox h2").text("关注成功！"),n.clearCookie("sign"),$(".showBox-href").click(function(){location.href="http://wopaitv.com/#cnzz_name=loading&cnzz_from=liveAttentionDownload"}),n.clearCookie("sign")),$("div").delegate(".zan","click",function(){window.location.href="http://wopaitv.com/#cnzz_name=loading&cnzz_from=livePraise"}),$("div").delegate(".commit","click",function(){window.location.href="http://wopaitv.com/#cnzz_name=loading&cnzz_from=liveComment"}),$(".openApp a").click(function(){window.location.href="http://wopaitv.com/#cnzz_name=loading&cnzz_from=liveDownload"});var a=$(".duration").attr("data-duration");if(v.timeFn(a),$(".duration").text(v.timeFn(a)),v.closeBox($(".showBox span"),$(".showBox")),v.closeBox($(".showBox span"),$(".bgBox")),"aaa"==e){var s=$("#attentionBtn").attr("data-userId");i.isAttention(s).done(function(t){0==t.result?($("#attentionBtn").attr("data-isAttention","0"),$("#attentionBtn").removeClass("attenBtnActive").addClass("attenBtn"),$("#attentionBtn").one("click",function(){v.attention()})):1==t.result&&($("#attentionBtn").attr("data-isAttention","1"),$("#attentionBtn").removeClass("attenBtn").addClass("attenBtnActive"))})}else if("bbb"==e){var s=$("#attentionBtn").attr("data-userId");i.isAttention(s).done(function(t){0==t.result?($("#attentionBtn").attr("data-isAttention","0"),$("#attentionBtn").removeClass("attenBtnActive").addClass("attenBtn"),v.attention()):1==t.result&&($("#attentionBtn").attr("data-isAttention","1"),$("#attentionBtn").removeClass("attenBtn").addClass("attenBtnActive"))})}else if(""==e&&""!=d){var s=$("#attentionBtn").attr("data-userId");i.isAttention(s).done(function(t){console.log(t),"200"==t.code&&(0==t.result?($("#attentionBtn").attr("data-isAttention","0"),$("#attentionBtn").removeClass("attenBtnActive").addClass("attenBtn"),$("#attentionBtn").one("click",function(){v.attention()})):1==t.result&&($("#attentionBtn").attr("data-isAttention","1"),$("#attentionBtn").removeClass("attenBtn").addClass("attenBtnActive")))}).fail(function(t){"401"==t.code&&(n.clearCookie("uid"),$(".canPlay").attr("src",""),location.reload())})}else""==e&&""==d&&$("#attentionBtn").on("click",function(){o.alertMsg("请登录"),setInterval(function(){window.location.href=n.getRequestPrefix()+"/page/user/login",n.setCookie("login","")},1e3)})},roomList:function(){var t=1,e=6,n=1,o="";$(".videoListBox ul");i.getRoomList(t,e,n,o).done(function(t){if(t.result.length<7){v.makeLiveList(t.result,s);var e=1,n=6-t.result.length,o=0,a="",s=$(".videoListBox ul");i.getRoomList(e,n,o,a).done(function(t){v.makeLiveList(t.result,s)})}})},makeLiveList:function(t){var e=$(".videoListBox ul");$.each(t,function(t,n){if(n.id==l)return!0;var o;o=1==n.anchorVstat?'<em class="userV1"></em>':2==n.anchorVstat?'<em class="userV2"></em>':3==n.anchorVstat?'<em class="userV3"></em>':"";var i;i=n.title?n.title:n.anchorName;var a='<li><a href="http://wopaitv.com/#cnzz_name=loading&cnzz_from=liveList"><img data-userPic="'+n.roomPic+'" data-videoId="'+l+'"src="" class="hotPic"></a><div class="videoList"><span class="fr"><em class="playNum"></em>'+n.maxAccessNumber+'</span></div><div class="userTit"><div class="useradddV"><img class="fl hotUesrPic go-user-page" data-userId="'+n.creatorId+'" data-userPic="'+n.anchorPic+'" src="" onerror="this.src=\'/restwww/img/icons-2x/user_icon_24px.png\'">'+o+'</div><span class="userName">'+i+"</span></div>";e.append(a),$(".hotPic").css("height",$(".hotPic").width())}),n.personalPortrait(r,$(".hotPic")),n.personalPortrait(r,$(".hotUesrPic"))},goPage:function(t,e,o){var i="",a={};"video"==t?(i=c+"/page/video/videoDetail?videoId="+e+o,a={uid:d,isNext:videoShow.isNext,nextType:videoShow.nextType,activityId:videoShow.activityId,tag:videoShow.tag,userId:videoShow.userId}):"userId"==t&&(i=c+"/page/user/userDetail?userId="+e+o,a={uid:d}),n.postform(i,a)},attention:function(){var t=$("#attentionBtn").attr("data-userId"),e="h5",o=$("#attentionBtn").attr("data-isAttention");""==d?window.location.href=n.getRequestPrefix()+"/page/user/login":i.addAttention(t,e,o).done(function(t){$("#attentionBtn").attr("data-isAttention","1"),$("#attentionBtn").removeClass("attenBtn").addClass("attenBtnActive"),$(".showBox").show(),$(".bgBox").show(),$(".showBox h2").text("关注成功！")})},jump:function(t){function e(){setTimeout(function(){window.location.href="http://www.wopaitv.com#cnzz_name=loading&cnzz_from=videoDetailDownload"},3e3)}var n=$("#roomId").val();s.versions.ios?s.versions.isWx||s.versions.isQQ||s.versions.isWeiBo?$(".skyBox").show():(t.attr("href","wopai://roomid="+n),e()):s.versions.android?s.versions.isWx||s.versions.isQQ||s.versions.isWeiBo?$(".skyBox-anz").show():(t.attr("href","com.busap.myvideo://main/openwith?roomId="+l+"&type=11"),e()):window.location.href="http://www.wopaitv.com#cnzz_name=loading&cnzz_from=videoDetailDownload",$(".skyBox,.skyBox-anz").click(function(){$(this).hide()})},shareFn:function(){var t=$(this).attr("data-name"),e=$(this).attr("data-desc"),n=r+$(this).attr("data-videopic"),o=$(this).attr("data-videoId"),i=$(this).attr("data-userId"),s=1;_czc.push(["_trackEvent","分享按钮","videoDetailTurn"]),a.init(t,e,n,o,d,i,s)},closeBox:function(t,e){t.on("click",function(){e.hide()})},timeFn:function(t){if(t/36e5>1){var e=parseInt(t/36e5);if(t%36e5/6e4>1){var n=parseInt(t%36e5/6e4);if(t%36e5%6e4>1)var o=parseInt(t%36e5%6e4/1e3)}else{var e="0";if(t/6e4>1){var n=parseInt(t%6e4);if(t%6e4/1e3>1)var o=parseInt(t%6e4%1e3)}else var n="0",o=t/1e3}}else{var e="0";if(t/6e4>1){var n=parseInt(t/6e4);if(t%6e4/1e3>1)var o=parseInt(t%6e4/1e3)}else{var n="0";if(t/1e3>1)var o=parseInt(t%1e3)}}return e+":"+n+":"+o}};v.init()});