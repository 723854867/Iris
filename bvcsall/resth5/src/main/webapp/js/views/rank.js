define(["../libs/jquery-2.1.4","../common/info","../common/aler","../service/service","../common/share","head"],function(e,a,t,i,s,d){var r=a.getPicPerfix(),n=a.getRequestPrefix(),o=a.getCookie("uid"),c=0,l=5,u=1,p={init:function(){_this=this,this.tagName=$("#tagName").val(),_this.dataType="shoushi",_this.isNext=0,_this.nextType=4,p.getrankVideoList(c,l),a.personalPortrait(r,$(".activeImg")),p.changeShare(),$(window).scroll(function(){a.lazyPicLoad($(".playBox img")),a.lazyPicLoad($(".actvideoPic"))}),$(".rankloadMore").click(function(){return c+=5,c>=50?void t.alertMsg("没有更更多数据！"):void("shoushi"==_this.dataType?p.getrankVideoList(c,l):"renqi"==_this.dataType&&p.getPopularList(c,l,!1))}),$(".rankHead button").click(function(){$(".rankHead button").removeClass("on"),_this.dataType=$(this).attr("data"),_this.start=0,$(this).addClass("on"),"shoushi"==_this.dataType?(p.getrankVideoList(0,l,!0),_czc.push(["_trackEvent","切换收视榜","videoTop"])):"renqi"==_this.dataType&&(p.getPopularList(0,l,!0),_czc.push(["_trackEvent","切换人气榜","userTop"]))}),$("body").delegate(".sharewp","click",function(){var e=$(this).attr("data-videoid"),s=$(this).attr("data-userId");i.shareWopaiap(e,s,"",1,"h5").done(function(e){"200"==e.code&&(t.alertMsg("转发成功！"),$(".shareWrap").remove())}).fail(function(e){return"344"==e.code?(t.alertMsg("你已经转发过该视频！"),void $(".shareWrap").remove()):(t.alertMsg("请登录后操作"),void(window.location.href=a.getRequestPrefix()+"/page/user/login"))})})},changeShare:function(){i.CustomShare("2").done(function(e){if(""!=e.result){document.title=e.result.shareText;var a=$('<img class="sharePic" src="'+(r+e.result.shareImg)+'" width="0" height="0"/>');$("body").prepend(a)}})},getPopularList:function(e,a,s){i.getRankPopul(e,a).done(function(e){return""==e.result?void t.alertMsg("没有更更多数据！"):void p.takePopulerList(e.result,$(".videoList1 ul"),s)})},getrankVideoList:function(e,a,s){i.getRankVideo(u,e,a).done(function(e){return e.result.length>5?void t.alertMsg("没有更更多数据！"):void p.activeList(e.result,$(".videoList1 ul"),s)})},goPage:function(e,t){var i="",s={};"video"==e?(i=n+"/page/video/videoDetail?videoId="+t,s={uid:o,isNext:p.isNext,nextType:p.nextType}):"userId"==e&&(i=n+"/page/user/userDetail?userId="+t,s={uid:o}),a.postform(i,s)},shareFn:function(e){var a=$(e).attr("data-name"),t=$(e).attr("data-desc"),i=r+$(e).attr("data-videopic"),d=$(e).attr("data-videoId"),n=$(e).attr("data-userId");s.init(a,t,i,d,o,n)},numFn:function(e){return e=e>=1e4?(e/1e4).toFixed(2)+"万":e},takePopulerList:function(e,i,s){return s&&$(i).empty(),e.length=5,$(".rankPopuItem").length>=50?void t.alertMsg("没有更多数据！"):($.each(e,function(e,a){var t;t=1==a.vipStat?'<em class="userV1"></em>':2==a.vipStat?'<em class="userV2"></em>':3==a.vipStat?'<em class="userV3"></em>':"";var s;""!=a.signature&&null!=a.signature?s=a.signature:""!=a.addr&&null!=a.addr?s="TA来自"+a.addr:""!=a.age&&null!=a.age?s="TA是"+a.age:""!=a.sex&&null!=a.sex?(1==a.sex&&(s="TA的性别是男"),0==a.sex&&(s="TA的性别是女"),2==a.sex&&(s="TA的性别是男")):s="懒人没前途o(∩_∩)o 哈哈~";var d=p.numFn(a.dayPopularity),r='<li class="rankPopuItem" data-id="'+a.id+'"><div class="listUserMsg"><span class="fl rankKey">'+(e+1)+'</span><dl><dt><img class="actvideoPic" data-userId="'+a.id+'" data-userPic="'+a.pic+'" src="" alt="头像" onerror="this.src=\'/restwww/img/icons-2x/user_icon_24px.png\'">'+t+"</dt><dd><p>"+a.name+"</p><p>"+s+"</p><p>人气："+d+"</p></dd></dl></div></div></li>";$(i).append(r)}),$(".videoList1 ul .rankPopuItem").each(function(){var e=$(this).index();$(".rankKey").eq(e).text(e+1),0==e?$(".rankKey").eq(e).addClass("rankKey1").empty():1==e?$(".rankKey").eq(e).addClass("rankKey2").empty():2==e&&$(".rankKey").eq(e).addClass("rankKey3").empty()}),a.personalPortrait(r,$(".actvideoPic")),void $(".rankPopuItem").on("click",".actvideoPic",function(){var e=$(this).attr("data-userId");p.goPage("userId",e)}))},activeList:function(e,s,d){return d&&$(s).empty(),e.length>=5&&(e.length=5),$(".videoList1 ul li").length>=50?void t.alertMsg("没有更多数据！"):($.each(e,function(a,t){var i;i=1==e[a].user.vipStat?'<em class="userV1"></em>':2==e[a].user.vipStat?'<em class="userV2"></em>':3==e[a].user.vipStat?'<em class="userV3"></em>':"";var d;d=e[a].dayHotValue>=1e4?(e[a].dayHotValue/1e4).toFixed(1)+"万":e[a].dayHotValue;var r='<li data-id="'+t.id+'"><div class="listUserMsg"><dl><span class="fl rankKey">'+(a+1)+'</span><dt><img class="actvideoPic" data-userId="'+t.user.id+'" data-userPic="'+t.user.pic+'" src="" alt="头像" onerror="this.src=\'/restwww/img/icons-2x/user_icon_24px.png\'">'+i+"</dt><dd><p>"+t.user.name+'</p><p class="myDate" data-time="'+t.createDate+'"></p></dd><dd><em class="playIcon"></em><span class="playData">'+d+'</span> 热度</dd></dl></div><div class="playBox" data-videoid="'+t.id+'" data-videoKey="'+t.playKey+'"><div class="loadingGif" style="width:30px;height:30px;min-height:30px;position:absolute;left:0;top:0;display:none;z-index:999999;background-color:#000000;opacity:0.6;width:100%;height:50%;color:#ffffff;text-align:center;padding-top:50%;font-size:18px;"></div><img data-videoPic="'+t.videoPic+'" src="" alt="视频" class="videoPic"><em class="canPlay"></em></div><div class="videoListTag face">'+t.description+'</div><div class="shareBox"><div class="zan" data-praise='+t.praise+" data-videoid="+t.id+'><em class="off"></em><span>'+t.praiseCount+'</span></div><div class="commit" data-video='+t.id+"><em></em><span>"+t.evaluationCount+'</span></div><div class="Forward" data-name="'+t.user.name+'" data-userId="'+t.user.id+'" data-videoid="'+t.id+'" data-desc="'+t.description+'" data-videoPic="'+t.videoPic+'"><em></em></div></div></li>';$(s).append(r)}),$(".videoList1 ul li").each(function(){var e=$(this).index();$(".rankKey").eq(e).text(e+1),0==e?$(".rankKey").eq(e).addClass("rankKey1").empty():1==e?$(".rankKey").eq(e).addClass("rankKey2").empty():2==e&&$(".rankKey").eq(e).addClass("rankKey3").empty()}),a.videoUrl(serverUrlvid),a.personalPortrait(r,$(".actvideoPic")),a.videoInfo(r,$(".videoPic")),a.timeTransform(".myDate","data-time","MM-dd hh:mm"),a.faceFn($(".face")),$(".Forward").click(function(){p.shareFn($(this))}),$(".commit").each(function(){$(this).click(function(){var e=$(this).attr("data-video");p.goPage("video",e)})}),$(".listUserMsg").on("click",".actvideoPic",function(){var e=$(this).attr("data-userId");p.goPage("userId",e)}),void $(".zan").each(function(){"true"==$(this).attr("data-praise")&&$(this).find("em").addClass("on"),$(this).click(function(){var e=parseInt($(this).find("span").text()),s=$(this).attr("data-videoid");$(this).parent().attr("data-createrId");if("false"==$(this).attr("data-praise")||0==$(this).attr("data-praise")){var d=this;i.savePraise(s).done(function(a){$(d).attr("data-praise",!0),$(d).find("em").hasClass("on")?($(d).find("em").removeClass("on"),$(d).find("em").addClass("off"),$(d).find("span").text(e-1)):($(d).find("em").removeClass("off"),$(d).find("em").addClass("on"),$(d).find("span").text(e+1))}).fail(function(e){t.alertMsg("请登录后操作"),window.location.href=a.getRequestPrefix()+"/page/user/login"})}if("true"==$(this).attr("data-praise")||1==$(this).attr("data-praise")){var d=this;i.deletePraise(s).done(function(a){$(d).attr("data-praise",!1),$(d).find("em").hasClass("on")?($(d).find("em").removeClass("on"),$(d).find("em").addClass("off"),$(d).find("span").text(e-1)):($(d).find("em").removeClass("off"),$(d).find("em").addClass("on"),$(d).find("span").text(e+1))}).fail(function(e){t.alertMsg("请登录后操作"),window.location.href=a.getRequestPrefix()+"/page/user/login"})}})}))}};p.init()});