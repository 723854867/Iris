define(["../libs/jquery-2.1.4","../common/info","../common/aler","../service/service","../common/share","head","../common/browse"],function(i,a,t,e,s,o,d){var n=a.getPicPerfix(),r=a.getRequestPrefix(),c=a.getCookie("uid"),l={init:function(){this.tagName=$("#tagName").val(),_this=this,_this.isNext=0,_this.nextType=3,l.getTagList(""),$("#btnMore").click(function(){this.lastId=$(".videoList1 ul li").last().attr("data-id"),l.getTagList(this.lastId)}),$("body").delegate(".Forward","click",l.shareFn),a.personalPortrait(n,$(".activeImg")),$(window).scroll(function(){a.lazyPicLoad($(".playBox img")),a.lazyPicLoad($(".actvideoPic"))}),$(".downClose").click(function(){_czc.push(["_trackEvent","关闭活动标签下载按钮","closeBottomDownload"])}),$(".join-tag").click(function(){function i(){setTimeout(function(){window.location.href="http://www.wopaitv.com/"},3e3)}d.versions.ios?d.versions.isWx||d.versions.isQQ||d.versions.isWeiBo?$(".skyBox").show():($(this).attr("href","wopai://hottagname="+encodeURI(_this.tagName)),i()):d.versions.android?d.versions.isWx||d.versions.isQQ||d.versions.isWeiBo?$(".skyBox-anz").show():($("#openapp").attr("src","com.busap.myvideo://main/openwith?Tag="+_this.tagName+"&type=2"),i()):window.location.href="http://www.wopaitv.com/",$(".skyBox").click(function(){$(this).hide()}),$(".skyBox-anz").click(function(){$(this).hide()})}),$("body").delegate(".sharewp","click",function(){var i=$(this).attr("data-videoid"),s=$(this).attr("data-userId");e.shareWopaiap(i,s,"",1,"h5").done(function(i){"200"==i.code&&(t.alertMsg("转发成功！"),$(".shareWrap").remove())}).fail(function(i){return"344"==i.code?(t.alertMsg("你已经转发过该视频！"),void $(".shareWrap").remove()):(t.alertMsg("请登录后操作"),void(window.location.href=a.getRequestPrefix()+"/page/user/login"))})})},getTagList:function(i){e.getActiveTagList(l.tagName,10,i).done(function(i){return""==i.result.content?void t.alertMsg("没有更更多数据！"):void l.activeList(i.result.content,$(".videoList1 ul"))})},goPage:function(i,t){var e="",s={};"video"==i?(e=r+"/page/video/videoDetail?videoId="+t,s={uid:c,isNext:l.isNext,nextType:l.nextType,tag:l.tagName}):"userId"==i&&(e=r+"/page/user/userDetail?userId="+t,s={uid:c}),a.postform(e,s)},shareFn:function(){var i=$(this).attr("data-name"),a=$(this).attr("data-desc"),t=n+$(this).attr("data-videopic"),e=$(this).attr("data-videoId"),o=$(this).attr("data-userId");s.init(i,a,t,e,c,o)},activeList:function(i,s){$.each(i,function(i,a){var t;t=1==a.user.vipStat?'<em class="userV1"></em>':2==a.user.vipStat?'<em class="userV2"></em>':3==a.user.vipStat?'<em class="userV3"></em>':"";var e,o=[];$.each(a.tags,function(i,a){o.push("#"+a+"#"),e=o.join(" ")});var d='<li data-id="'+a.id+'"><div class="listUserMsg"><dl><dt><img class="actvideoPic" data-userId="'+a.user.id+'" data-userPic="'+a.user.pic+'" src="" alt="头像" onerror="this.src=\'/restwww/img/icons-2x/user_icon_24px.png\'">'+t+"</dt><dd><p>"+a.user.name+'</p><p class="myDate" data-time="'+a.createDate+'"></p></dd><dd><em class="playIcon"></em><span class="playData">'+a.showPlayCount+'</span></dd></dl></div><div class="playBox" data-videoid="'+a.id+'" data-videoKey="'+a.playKey+'"><div class="loadingGif" style="width:30px;height:30px;min-height:30px;position:absolute;left:0;top:0;display:none;z-index:999999;background-color:#000000;opacity:0.6;width:100%;height:50%;color:#ffffff;text-align:center;padding-top:50%;font-size:18px;"></div><img data-videoPic="'+a.videoPic+'" src="" alt="视频" class="videoPic"><em class="canPlay"></em></div><div class="videoListTag face">'+e+'</div><div class="shareBox"><div class="zan" data-praise='+a.praise+" data-videoid="+a.id+'><em class="off"></em><span>'+a.praiseCount+'</span></div><div class="commit" data-video='+a.id+"><em></em><span>"+a.evaluationCount+'</span></div><div class="Forward" data-name="'+a.user.name+'" data-userId="'+a.user.id+'" data-videoid="'+a.id+'" data-desc="'+a.description+'" data-videoPic="'+a.videoPic+'"><em></em></div></div></li>';$(s).append(d)}),a.videoUrl(serverUrlvid),a.personalPortrait(n,$(".actvideoPic")),a.videoInfo(n,$(".videoPic")),a.timeTransform(".myDate","data-time","MM-dd hh:mm"),a.faceFn($(".face")),a.playNum($(".playData")),$(".Forward").click(function(){l.shareFn($(this))}),$(".commit").each(function(){$(this).click(function(){var i=$(this).attr("data-video");l.goPage("video",i)})}),$(".listUserMsg").on("click",".actvideoPic",function(){var i=$(this).attr("data-userId");l.goPage("userId",i)}),$(".zan").each(function(){"true"==$(this).attr("data-praise")&&$(this).find("em").addClass("on"),$(this).click(function(){var i=parseInt($(this).find("span").text()),s=$(this).attr("data-videoid");$(this).parent().attr("data-createrId");if("false"==$(this).attr("data-praise")||0==$(this).attr("data-praise")){var o=this;e.savePraise(s).done(function(a){$(o).attr("data-praise",!0),$(o).find("em").hasClass("on")?($(o).find("em").removeClass("on"),$(o).find("em").addClass("off"),$(o).find("span").text(i-1)):($(o).find("em").removeClass("off"),$(o).find("em").addClass("on"),$(o).find("span").text(i+1))}).fail(function(i){t.alertMsg("请登录后操作"),window.location.href=a.getRequestPrefix()+"/page/user/login"})}if("true"==$(this).attr("data-praise")||1==$(this).attr("data-praise")){var o=this;e.deletePraise(s).done(function(a){$(o).attr("data-praise",!1),$(o).find("em").hasClass("on")?($(o).find("em").removeClass("on"),$(o).find("em").addClass("off"),$(o).find("span").text(i-1)):($(o).find("em").removeClass("off"),$(o).find("em").addClass("on"),$(o).find("span").text(i+1))}).fail(function(i){t.alertMsg("请登录后操作"),window.location.href=a.getRequestPrefix()+"/page/user/login"})}})})}};l.init()});