define(["../libs/jquery-2.1.4","../common/browse"],function(e,t){var i,n=0,a={playV:function(e,i,d){0==i.parent().find("video").length&&($(".videoPic").show(),$(".canPlay").show(),$("video").remove(),i=i[0],n=1,this.media=document.createElement("video"),this.media.setAttribute("x-webkit-airplay",""),this.media.setAttribute("webkit-playsinline","controls"),t.versions.ios?this.media.style.height=window.screen.width+"px":this.media.style.height=i.parentNode.offsetHeight+"px",this.oparent=i.parentNode,this.oparent.appendChild(this.media),this.media.setAttribute("src",e),this.media.style.display="block",this.videoPic=this.oparent.getElementsByTagName("img")[0],this.videoBtn=this.oparent.getElementsByTagName("em")[0],this.videoPic.style.display="none",this.videoBtn.style.display="none",a.addEvent("ended",this.media,function(){a.playEnd(this)}),a.addEvent("pause",this.media,function(){}),this.videoBtn.addEventListener("click",function(){a.media.play(),a.oparent.getElementsByTagName("em")[0].style.display="none"}),this.media.addEventListener("click",function(){a.playPause()}),this.media.play(),a.timerFn(),event.preventDefault())},timerFn:function(){var e=this.media;e.addEventListener("loadedmetadata",function(){var n=e.duration;i=setInterval(function(){var d=a.getEnd(e);e.currentTime;t.versions.isWeiBo?a.addEvent("webkitendfullscreen",e,function(){e.pause(),$(".canPlay").show()}):n/4>d?($("video").parent().find(".bgBox").show(),$("video").parent().find(".loadingGif").show(),e.pause(),$(".loadingGif").text(parseInt(d/n*100)+"%")):e.ended?clearInterval(i):($("video").parent().find(".bgBox").hide(),$("video").parent().find(".loadingGif").hide(),e.play())},1e3)})},addEvent:function(e,t,i){t.addEventListener(e,i)},removeEvent:function(e,t,i){t.removeEventListerner(e,i)},playEnd:function(e){n=0,a.oparent.getElementsByTagName("em")[0].style.display="block",a.oparent.getElementsByTagName("img")[0].style.display="block",a.oparent.removeChild(a.media)},playPause:function(){this.media.paused?(n=2,this.media.play(),this.media.parentNode.getElementsByTagName("em")[0].style.display="none",a.timerFn()):(this.media.pause(),this.media.parentNode.getElementsByTagName("em")[0].style.display="block",clearInterval(i))},getEnd:function(e){var t=0;try{t=e.buffered.end(0)||0}catch(i){}return t}};return a});