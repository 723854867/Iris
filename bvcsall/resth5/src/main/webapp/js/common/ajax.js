define(["../libs/jquery-2.1.4","../common/aler","../common/info"],function(e,t,o){var n={};return{getAccessToken:function(){var e=o.getCookie("access_token");return e||""},getCurrentUid:function(){var e=o.getCookie("uid");return e||"0"},_onced:!1,once:function(){return this._onced=!0,this},_quieted:!1,quiet:function(){return this._quieted=!0,this},postJSON:function(e,i){var r=$.Deferred();if(this._onced&&n[e])return this._onced=!1,r;var s=this._quieted;return this._quieted&&(this._quieted=!1),i||(i={}),i.access_token=this.getAccessToken(),n[e]=!0,$.ajaxSetup({beforeSend:function(e){$("#btnMore").html('<img width="30" height="30" style="display:block;margin:5px auto;padding:10px 0;" src="'+o.getRequestPrefix()+'/img/icons-2x/loading.gif" />'),$("#btnMore").removeClass("loadMore")},complete:function(){$("#btnMore").show(),setTimeout(function(){$("#btnMore").html("加载更多"),$("#btnMore").addClass("loadMore")},1e3)}}),$.post(e,i,"json").done(function(o){""==o.result?$("#btnMore").hide():$("#btnMore").show(),$("#btnMore").show(),delete n[e];var i="系统繁忙，请稍后再试。";!o||"200"!=o.code&&(i=o.message)?(s||t.alertMsg(i),r.reject(o)):r.resolve(o)}).fail(function(){s||t.alertMsg("系统繁忙，稍后重试。"),delete n[e],r.reject({})}),r},postJSONWithBeforeSend:function(e,t){var i=$.Deferred();if(this._onced&&n[e])return this._onced=!1,i;this._quieted;this._quieted&&(this._quieted=!1),t||(t={}),t.access_token=this.getAccessToken();var r=this.getCurrentUid();return n[e]=!0,$.ajax({type:"post",data:t,dataType:"json",url:e,beforeSend:function(e){e.setRequestHeader("uid",r),$("#btnMore").html('<img width="30" style="display:block;margin:0 auto;padding:5px 0;" src="'+o.getRequestPrefix()+'/img/icons-2x/loading.gif" />'),$("#btnMore").removeClass("loadMore")}}).done(function(t){setTimeout(function(){$("#btnMore").html("加载更多"),$("#btnMore").addClass("loadMore"),$("#btnMore").show()},1e3),delete n[e];var o="系统繁忙，请稍后再试。";!t||"200"!=t.code&&(o=t.message)?i.reject(t):i.resolve(t)}).fail(function(){delete n[e],i.reject({})}),i},postJSONWithBeforeSendNew:function(e,t){var o=$.Deferred();if(this._onced&&n[e])return this._onced=!1,o;this._quieted;this._quieted&&(this._quieted=!1),t||(t={}),t.access_token=this.getAccessToken();var i=this.getCurrentUid();return n[e]=!0,$.ajax({type:"post",data:t,dataType:"json",url:e,beforeSend:function(e){e.setRequestHeader("uid",i)}}).done(function(t){setTimeout(function(){$("#btnMore").html("加载更多"),$("#btnMore").addClass("loadMore")},1e3),delete n[e];var i="系统繁忙，请稍后再试。";!t||"200"!=t.code&&(i=t.message)?o.reject(t):o.resolve(t)}).fail(function(){delete n[e],o.reject({})}),o},postJSONWithBeforeSendAtten:function(e,t){var i=$.Deferred();if(this._onced&&n[e])return this._onced=!1,i;this._quieted;this._quieted&&(this._quieted=!1),t||(t={}),t.access_token=this.getAccessToken();var r=this.getCurrentUid();return n[e]=!0,$.ajax({type:"post",data:t,dataType:"json",url:e,beforeSend:function(e){e.setRequestHeader("uid",r),$("#btnMore").html('<img width="30" style="display:block;margin:0 auto;padding:5px 0;" src="'+o.getRequestPrefix()+'/img/icons-2x/loading.gif" />'),$("#btnMore").removeClass("loadMore")}}).done(function(t){$("#btnMore").show(),t.result.length<10?$("#btnMore").hide():$("#btnMore").show(),setTimeout(function(){$("#btnMore").html("加载更多"),$("#btnMore").addClass("loadMore")},1e3),delete n[e];var o="系统繁忙，请稍后再试。";!t||"200"!=t.code&&(o=t.message)?i.reject(t):i.resolve(t)}).fail(function(){delete n[e],i.reject({})}),i},postJSONWithBeforeSendHit:function(e,t){var i=$.Deferred();if(this._onced&&n[e])return this._onced=!1,i;this._quieted;this._quieted&&(this._quieted=!1),t||(t={}),t.access_token=this.getAccessToken();var r=this.getCurrentUid();return n[e]=!0,$.ajax({type:"post",data:t,dataType:"json",url:e,beforeSend:function(e){e.setRequestHeader("uid",r),$("#btnMore").html('<img width="30" style="display:block;margin:0 auto;padding:5px 0;" src="'+o.getRequestPrefix()+'/img/icons-2x/loading.gif" />'),$("#btnMore").removeClass("loadMore"),$("#btnMore").hide()}}).done(function(t){$("#btnMore").show(),t.result.length<5?$("#btnMore").hide():$("#btnMore").show(),setTimeout(function(){$("#btnMore").html("加载更多"),$("#btnMore").addClass("loadMore")},1e3),delete n[e];var o="系统繁忙，请稍后再试。";!t||"200"!=t.code&&(o=t.message)?i.reject(t):i.resolve(t)}).fail(function(){delete n[e],i.reject({})}),i},postJSONWithBeforeSendPraise:function(e,t){var i=$.Deferred();if(this._onced&&n[e])return this._onced=!1,i;this._quieted;this._quieted&&(this._quieted=!1),t||(t={}),t.access_token=this.getAccessToken();var r=this.getCurrentUid();return n[e]=!0,$.ajax({type:"post",data:t,dataType:"json",url:e,beforeSend:function(e){e.setRequestHeader("uid",r),$("#btnMore").html('<img width="30" style="display:block;margin:0 auto;padding:5px 0;" src="'+o.getRequestPrefix()+'/img/icons-2x/loading.gif" />'),$("#btnMore").removeClass("loadMore")}}).done(function(t){$("#btnMore").show(),setTimeout(function(){$("#btnMore").html("加载更多"),$("#btnMore").addClass("loadMore")},1e3),delete n[e];var o="系统繁忙，请稍后再试。";!t||"200"!=t.code&&(o=t.message)?i.reject(t):i.resolve(t)}).fail(function(){delete n[e],i.reject({})}),i}}});