require.config({shim:{"../libs/jquery.qqFace":["../libs/jquery-2.1.4"]}}),define(["../libs/jquery-2.1.4","../libs/jquery.qqFace","../common/share","../common/playbox2","../libs/md5Utils","../common/aler"],function(e,t,o,s,a,i){var r=0,n={appDownUrl:"http://wopaitv.com/download/myVideo_guanwang_3.2.3.apk",setCookie:function(e,t,o){var s=new Date;s.setTime(s.getTime()+24*o*60*60*1e3);var a="expires="+s.toUTCString();document.cookie=e+"="+t+"; "+a+";path=/"},getCookie:function(e){for(var t=e+"=",o=document.cookie.split(";"),s=0;s<o.length;s++){for(var a=o[s];" "==a.charAt(0);)a=a.substring(1);if(-1!=a.indexOf(t))return a.substring(t.length,a.length)}return""},clearCookie:function(e){document.cookie=e+"=;expires=0;;path=/"},getRequestPrefix:function(){return $("#interfaceurl").val()+"/resth5"},getVideoPrefix:function(){return $("#serverUrlvid").val()+"/hls/play/"},getPicPerfix:function(){return $("#serverUrlimg").val()+"/restwww/download"},personalInfo:function(e,t){var o=$(t).attr("data-homePicSrc"),s=n.getPicPerfix()+o;$(t).attr("src",s)},personalPortrait:function(e,t,o){$(t).each(function(){var e=$(this).attr("data-userPic"),t=n.getPicPerfix()+e;$(this).closest("li").length>0?($(this).attr("lazy_src",t),n.lazyPicLoad($(this))):$(this).attr("src",t)})},videoInfo:function(e,t){$(t).each(function(){var e=$(this).attr("data-videoPic"),t=n.getPicPerfix()+e;$(this).closest("li").length>0?($(this).attr("lazy_src",t),n.lazyPicLoad($(this))):$(this).attr("src",t)})},videoUrl:function(e){$("body").on("touchstart",".canPlay",function(){var e=$(this).parent().attr("data-videoKey"),t=$(this).parent().attr("data-videoId"),o=n.getVideoPrefix()+e+".mp4";s.playV(o,$(this));var a={id:t,c:1};$(this).off("touchstart"),$.ajax({type:"post",url:n.getRequestPrefix()+"/video/incCount",data:a,success:function(e){},error:function(){}})}),$("body").on("click",".videoPic",function(){n.videoPlay($(this))})},videoPlay:function(e){var t=e.parent().attr("data-videoKey"),o=e.parent().attr("data-videoId"),a=n.getVideoPrefix()+t+".mp4";s.playV(a,e);var i={id:o,c:1};e.off("touchstart"),$.ajax({type:"post",url:n.getRequestPrefix()+"/video/incCount",data:i,success:function(e){},error:function(){}})},timeTransform:function(e,t,o){var s=$(e);s.each(function(){var e=$(this).attr(t),s=new Date;s.setTime(e),Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};/(y+)/i.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e};var a=(new Date).getTime(),i=s.format(o),r=a-e;if(r>1728e5&&31536e6>r)$(this).text(i);else if(1728e5>r&&r>864e5)$(this).text("昨天"+i.split(" ")[1]);else if(864e5>r&&r>36e5)$(this).text(parseInt(r/1e3/60/60)+"小时前");else if(36e5>r&&r>6e4)$(this).text(parseInt(r/1e3/60)+"分钟前");else if(6e4>r)$(this).text("刚刚");else if(r>31536e6){var n=new Date(parseInt(r)).toLocaleString().replace(/:\d{1,2}$/," ").split(" ")[3];$(this).text(n+"年 "+i)}})},getAuthorization_code:function(e,t){$.ajax({url:n.getRequestPrefix()+"/authorize",data:{response_type:"code",client_id:"c1ebe466-1cdc-4bd3-ab69-77c3561b9dee",username:e,password:a.md5(t)},type:"post",async:!1,cache:!1,dataType:"json",success:function(e){"200"==e.code?(authorization_code=e.result.authorization_code,n.getAccess_token()):i.alertMsg(e.message)},error:function(){i.alertMsg("获得登陆授权码失败！")}})},getAccess_token:function(){$.ajax({url:n.getRequestPrefix()+"/accessToken",data:{grant_type:"authorization_code",code:authorization_code,client_id:"c1ebe466-1cdc-4bd3-ab69-77c3561b9dee",client_secret:"d8346ea2-6017-43ed-ad68-19c0f971738b",redirect_uri:"url"},type:"post",async:!1,cache:!1,dataType:"json",success:function(e){"200"==e.code?(access_token=e.result.access_token,n.setCookie("access_token",access_token,7),redirectFlag=!0,n.getUserInfo()):i.alertMsg(e.message)},error:function(){i.alertMsg("获得登陆token失败！")}})},getUserInfo:function(){$.ajax({url:n.getRequestPrefix()+"/userInfo",data:{access_token:access_token},type:"get",cache:!1,dataType:"json",success:function(e){if("200"==e.code){n.setCookie("uid",e.result.id,7);var t=n.getCookie("uid"),o=n.getCookie("access_token"),s=document.referrer;n.setCookie("backurl",s,7);var s=decodeURIComponent(n.getCookie("backurl"));if(1==r)s.indexOf("live")>0?location.href=s:location.href=n.getRequestPrefix()+"/page/user/getRecommendUser?uid="+t+"&access_token="+o;else if(""==s||s==n.getRequestPrefix()+"/page/user/login")location.href=n.getRequestPrefix()+"/page/homePage";else if(s==n.getRequestPrefix()+"/page/homePage"||s==n.getRequestPrefix()+"/page/rank")location.href=s;else if(s.indexOf("live")>0)n.setCookie("sign","bbb"),n.goPage("live",n.getCookie("backurl").split("?")[1].split("=")[1]);else{var a={uid:t,isNext:n.getCookie("isNext"),nextType:n.getCookie("nextType")};n.postform(s,a)}i.alertMsg("登录成功")}else i.alertMsg(e.message)},error:function(){i.alertMsg("获取资源失败！")}})},login:function(e,t){n.getAuthorization_code(e,t)},reg:function(e,t,o,s){$.ajax({url:n.getRequestPrefix()+"/user/reg",data:{phone:e,pass:a.md5(t),code:o,regPlatform:s},type:"post",async:!1,cache:!1,dataType:"json",success:function(o){"200"==o.code?(n.getAuthorization_code(e,t),r=1):i.alertMsg(o.message)},error:function(){i.alertMsg("注册失败！")}})},getCode:function(e,t){function o(e,t){0==t?(e.removeAttribute("disabled"),e.value="重新获取",$("#getCodeBtn").removeClass("btnCode1").addClass("btnCode"),t=t):(e.setAttribute("disabled",!0),e.value=t+"s",t--,setTimeout(function(){o(e,t)},1e3))}$.ajax({url:n.getRequestPrefix()+"/user/getCode",data:{phone:e,isReg:t},type:"post",async:!1,cache:!1,dataType:"json",success:function(e){if("200"==e.code){var t=document.getElementById("getCodeBtn");o(t,60),$("#btnCode").attr("disabled",!0),$("#getCodeBtn").removeClass("btnCode").addClass("btnCode1")}else"336"==e.code?i.alertMsg(e.message):"301"==e.code&&i.alertMsg(e.message)},error:function(){i.alertMsg("发送手机验证码失败！")}})},Sub:function(e,t,o){""==o?i.alertMsg("请输入密码！"):$.ajax({url:n.getRequestPrefix()+"/user/resetPass",data:{phone:e,code:t,pass:a.md5(o)},type:"post",async:!1,cache:!1,dataType:"json",success:function(e){"200"==e.code?(i.alertMsg("修改密码成功"),setInterval(function(){window.location.href="info.getRequestPrefix()+'/page/user/login"},1e3)):i.alertMsg(e.message)},error:function(){i.alertMsg("发送手机验证码失败！")}})},tabLove:function(e,t){$(e).hasClass("on")?($(e).removeClass("on"),$(e).addClass("off"),$(e).next().text(t-1)):($(e).removeClass("off"),$(e).addClass("on"),$(e).next().text(t+1))},postform:function(e,t){var o=document.createElement("form");o.action=e,o.method="post",o.style.display="none";for(var s in t){var a=document.createElement("textarea");a.name=s,a.value=t[s],o.appendChild(a)}return document.body.appendChild(o),o.submit(),o},lazyPicLoad:function(e){var t=$(document).scrollTop(),o=$(window).height();$(e).each(function(){var e=$(this).closest("li").offset().top;t+o>e&&$(this).attr("src",$(this).attr("lazy_src"))})},faceFn:function(e){$(e).each(function(e,t){$(t).replace_face($(this).html())})},scrollTop:function(){var e='<div class="scrollTop"></div>';$("body").append(e),$(".scrollTop").hide(),$(window).scroll(function(){var e=$(window).scrollTop();e>500&&$(".scrollTop").show(),500>e&&$(".scrollTop").hide(),$(".scrollTop").on("click",function(){$(window).scrollTop(0)})})},playNum:function(e){$(e).each(function(e,t){var o,s=$(this).text();s>1e4?(o=s/1e4,o=o.toFixed(2),$(this).text(o+"万")):$(this).text(o)})},goPage:function(e,t){var o=n.getRequestPrefix(),s=n.getCookie("uid"),a=n.getCookie("access_token"),i="",r={};"video"==e?(i=o+"/page/video/videoDetail?videoId="+t,r={uid:s,isNext:activeFn.isNext,nextType:activeFn.nextType}):"userId"==e?(i=o+"/page/user/userDetail?userId="+t,r={uid:s}):"live"==e&&(i=o+"/page/live/shareLive?roomId="+t,r={uid:s,access_token:a}),n.postform(i,r)}};return n});