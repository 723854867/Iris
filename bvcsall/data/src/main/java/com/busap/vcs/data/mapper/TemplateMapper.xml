<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.busap.vcs.data.mapper.TemplateMapper">  

	<resultMap id="BaseResultMap" type="com.busap.vcs.data.model.TemplateDisplay">
        <id column="id" property="id"/>
        <result column="create_at" property="createDate"/>
        <result column="modify_at" property="modifyDate"/>
        <result column="data_from" property="dataFrom"/>
        <result column="creator_id" property="creatorId"/>
        <result column="order_num" property="orderNum"/>
        <result column="act_id" property="actId"/>
        <result column="zip_url" property="zipUrl"/> 
        <result column="background_pic" property="backgroundPic"/>
        <result column="description" property="description"/>
        <result column="pic" property="pic"/>
        <result column="title" property="title"/>
        <result column="type" property="type"/>
        <result column="activityTitle" property="activityTitle"/>
        <result column="version_num" property="versionNum"/>
    </resultMap>
    
    <select id="getAll"  resultMap="BaseResultMap">
       select * from template where type=#{type} order by order_num 
    </select>

    <sql id="page">limit #{pageStart},#{pageSize}</sql>

    <sql id="where_sql">
        <where>
            <if test="type != null">
                AND t.type = #{type,jdbcType=INTEGER}
            </if>
            <if test="actId != null">
                AND t.act_id = #{actId,jdbcType=INTEGER}
            </if>
            <if test="title != null and title != ''">
                AND t.title LIKE CONCAT('%',#{title,jdbcType=VARCHAR},'%')
            </if>
        </where>
    </sql>

    <select id="selectTemplates" resultMap="BaseResultMap" parameterType="java.util.Map">
        SELECT
        t.id,
        t.create_at,
        t.modify_at,
        t.data_from,
        t.creator_id,
        t.order_num,
        t.act_id,
        t.zip_url,
        t.background_pic,
        t.type,
        t.title,
        t.pic,
        t.description,
        t.version_num,
        a.title as activityTitle
        FROM template t
        LEFT JOIN activity a ON a.id = t.act_id
        <include refid="where_sql"/>
        <!--<include refid="page"/>-->
    </select>

<!--    <select id="selectTemplateCount" resultType="java.lang.Integer" parameterType="map">
        SELECT
        COUNT(1)
        FROM template t
        LEFT JOIN activity a ON a.id = t.act_id
        <include refid="where_sql"/>
    </select>-->
</mapper>
