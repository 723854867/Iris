<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.busap.vcs.data.mapper.BannerDAO">
	<sql id="page">limit #{pageStart},#{pageSize}</sql>
	<sql id="bannerFiledSql"> 
		select b.id,
		b.create_at as createDate,
		b.modify_at as modifyDate,
		b.data_from as dataFrom,
		b.creator_id as creatorId,
		b.title,
		b.img_src as imgSrc,
		b.target_type as targetType,
		b.target_url as targetUrl,
		b.target_id as targetId,
		b.tag,
		b.show_able as showAble
    </sql>

	<select id="findAllBanner" resultType="com.busap.vcs.data.entity.Banner">
		<include refid="bannerFiledSql"/>
		from loop_banner b
		<where>
			<if test="showAble != 2">
				b.show_able = #{showAble} AND b.banner_type = 0
			</if>
		</where>
		order by order_num desc
	</select>

	<update id="updateSort" parameterType="java.util.Map">
		UPDATE loop_banner
		<set>
			order_num= #{orderNum}
		</set>
		WHERE id = #{id}
	</update>

	<select id="selectBannerByOrderNum" parameterType="java.util.Map" resultType="com.busap.vcs.data.entity.Banner">
		SELECT
		id,
		order_num AS orderNum
		FROM
		loop_banner
		<if test="ASC != '' and ASC != null">
			WHERE order_num <![CDATA[ > ]]> #{orderNum}
			ORDER BY order_num ASC
		</if>
		<if test="DESC != '' and DESC != null">
			WHERE order_num <![CDATA[ < ]]> #{orderNum}
			ORDER BY order_num DESC
		</if>
		<if test="MAX != '' and MAX != null">
			ORDER BY order_num DESC
		</if>
		LIMIT 1
	</select>

	<select id="selectByPrimaryKey" parameterType="java.lang.Long" resultType="com.busap.vcs.data.entity.Banner">
		SELECT
		id,
		order_num AS orderNum
		FROM
		loop_banner
		WHERE id = #{id}
	</select>

	<select id="selectBannerList" parameterType="map" resultType="com.busap.vcs.data.entity.Banner">
		SELECT id,
		create_at AS createDate,
		modify_at AS modifyDate,
		data_from AS dataFrom,
		creator_id AS creatorId,
		title,
		img_src AS imgSrc,
		target_type AS targetType,
		target_url AS targetUrl,
		target_id AS targetId,
		tag,
		order_num AS orderNum,
		show_able AS showAble,
		banner_type AS bannerType
		FROM loop_banner
		<where>
			<if test="showAble != null">
				AND show_able = #{showAble}
			</if>
			<if test="bannerType != null">
				AND banner_type = #{bannerType}
			</if>
		</where>
		ORDER BY order_num DESC
	</select>

</mapper>