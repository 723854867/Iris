<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.busap.vcs.data.mapper.AdminVideoMapper">
<!-- 	<cache eviction="FIFO" flushInterval="300000" size="1000" readOnly="true"/> -->

	<select id="searchAdminVideo" parameterType="java.util.Map" resultType="com.busap.vcs.data.entity.Video">
		select o.*,r.name nameEn,o.create_at showDate,o.plan_publish_time planPublishTime,o.publish_time publishTime, o.is_logo isLogo,o.flow_stat flowStat,o.play_key playKey,o.video_pic videoPic,o.video_list_pic videoListPic
		from video o left join ruser r on o.creator_id=r.id where o.data_from = 'myvideo_restadmin'
		<if test="startTime !=null and startTime != '' and endTime !=null and endTime != ''">
			and o.publish_time between #{startTime} and #{endTime}
		</if>
		<if test="description !=null and description != ''">
			and o.description like CONCAT('%',#{description},'%') 
		</if>
		<if test="tag !=null and tag != ''">
			and o.tag like CONCAT('%',#{tag},'%') 
		</if>
		<choose>
			<when test="flow_stat !=null and flow_stat != ''">
				and o.flow_stat=#{flow_stat}
			</when>
			<otherwise>
				<![CDATA[
					and o.flow_stat <> 'delete'
				]]>
			</otherwise>
		</choose>
		<if test="isLogo !=null and isLogo != ''">
			and o.is_logo = #{isLogo}
		</if>
		<if test="username !=null and username != ''">
			and o.creator_id = #{username}
		</if>
 		order by create_at desc limit #{iStart},#{iEnd}
	</select>
	
	<select id="searchAdminVideoActivity" parameterType="java.util.Map" resultType="com.busap.vcs.data.entity.Video">
		select o.*,r.name nameEn,o.create_at showDate,o.plan_publish_time planPublishTime,o.publish_time publishTime, o.is_logo isLogo,o.flow_stat flowStat,o.play_key playKey,o.video_pic videoPic,o.video_list_pic videoListPic
		from activity_video a inner join video o on a.videoid=o.id left join ruser r on o.creator_id=r.id where o.data_from = 'myvideo_restadmin'
		<if test="startTime !=null and startTime != '' and endTime !=null and endTime != ''">
			and o.create_at between #{startTime} and #{endTime}
		</if>
		<if test="description !=null and description != ''">
			and o.description like CONCAT('%',#{description},'%') 
		</if>
		<if test="tag !=null and tag != ''">
			and o.tag like CONCAT('%',#{tag},'%') 
		</if>
  		<choose>
			<when test="flow_stat !=null and flow_stat != ''">
				and o.flow_stat=#{flow_stat}
			</when>
			<otherwise>
				<![CDATA[
					and o.flow_stat <> 'delete'
				]]>
			</otherwise>
		</choose>
		<if test="isLogo !=null and isLogo != ''">
			and o.is_logo = #{isLogo}
		</if>
 		<if test="activityId !=null and activityId != ''">
 			and a.activityid = #{activityId}
 		</if>
		<if test="username !=null and username != ''">
			and o.creator_id = #{username}
		</if>
 		order by create_at desc limit #{iStart},#{iEnd}
	</select>

	<select id="searchAdminVideoCount" resultType="long" parameterType="java.util.Map">
		select count(1) from video o left join ruser r on o.creator_id=r.id where o.data_from = 'myvideo_restadmin'
		<if test="startTime !=null and startTime != '' and endTime !=null and endTime != ''">
			and o.create_at between #{startTime} and #{endTime}
		</if>
		<if test="description !=null and description != ''">
			and o.description like CONCAT('%',#{description},'%') 
		</if>
		<if test="tag !=null and tag != ''">
			and o.tag like CONCAT('%',#{tag},'%') 
		</if>
  		<choose>
			<when test="flow_stat !=null and flow_stat != ''">
				and o.flow_stat=#{flow_stat}
			</when>
			<otherwise>
				<![CDATA[
					and o.flow_stat <> 'delete'
				]]>
			</otherwise>
		</choose>
		<if test="isLogo !=null and isLogo != ''">
			and o.is_logo = #{isLogo}
		</if>
		<if test="username !=null and username != ''">
			and o.creator_id = #{username}
		</if>
	</select>
	
	<select id="searchAdminVideoCountActivity" resultType="long" parameterType="java.util.Map">
		select count(1) from activity_video a inner join video o on a.videoid=o.id left join ruser r on o.creator_id=r.id where o.data_from = 'myvideo_restadmin'
		<if test="startTime !=null and startTime != '' and endTime !=null and endTime != ''">
			and o.create_at between #{startTime} and #{endTime}
		</if>
		<if test="description !=null and description != ''">
			and o.description like CONCAT('%',#{description},'%') 
		</if>
		<if test="tag !=null and tag != ''">
			and o.tag like CONCAT('%',#{tag},'%') 
		</if>
		<choose>
			<when test="flow_stat !=null and flow_stat != ''">
				and o.flow_stat=#{flow_stat}
			</when>
			<otherwise>
				<![CDATA[
					and o.flow_stat <> 'delete'
				]]>
			</otherwise>
		</choose>
		<if test="isLogo !=null and isLogo != ''">
			and o.is_logo = #{isLogo}
		</if>
		<if test="activityId !=null and activityId != ''">
			and a.activityid = #{activityId}
		</if>
		<if test="username !=null and username != ''">
			and o.creator_id = #{username}
		</if>
	</select>

	<sql id="page">limit #{pageStart},#{pageSize}</sql>

	<sql id="where_sql">
		<where>
			<if test="dataFrom != null and dataFrom != ''">
				AND v.data_from = #{dataFrom}
			</if>
			<if test="startTime !=null and startTime != '' and endTime !=null and endTime != ''">
				AND v.publish_time between #{startTime} and #{endTime}
			</if>
			<if test="description !=null and description != ''">
				AND v.description like CONCAT('%',#{description},'%')
			</if>
			<if test="tag !=null and tag != ''">
				AND v.tag like CONCAT('%',#{tag},'%')
			</if>
			<choose>
				<when test="flowStat !=null and flowStat != ''">
					AND v.flow_stat=#{flow_stat}
				</when>
				<otherwise>
					<![CDATA[
					AND v.flow_stat <> 'delete'
				]]>
				</otherwise>
			</choose>
			<if test="isLogo !=null and isLogo != ''">
				AND v.is_logo = #{isLogo}
			</if>
			<if test="username !=null and username != ''">
				AND v.creator_id = #{username}
			</if>
		</where>
	</sql>

	<select id="selectAdministratorVideos" parameterType="java.util.Map" resultType="com.busap.vcs.data.entity.Video">
		SELECT
		v.name,
		v.description,
		v.video_activity AS videoActivity,
		v.tag,
		v.flow_stat AS flowStat,
		v.is_logo AS isLogo,
		v.publish_time AS publishTime,
		v.plan_publish_time AS planPublishTime,
		v.create_at AS showDate,
		v.play_key AS playKey,
		v.video_pic AS videoPic,
		v.video_list_pic AS videoListPic,
		r.name AS nameEn
		FROM video v
		LEFT JOIN ruser r ON v.creator_id = r.id
		<include refid="where_sql"/>
		order by v.create_at desc
		<include refid="page"/>
	</select>

	<select id="selectAdministratorVideoCount" resultType="java.lang.Integer" parameterType="map">
		SELECT
		COUNT(1)
		FROM video v
		LEFT JOIN ruser r ON v.creator_id = r.id
		<include refid="where_sql"/>
	</select>

</mapper>
