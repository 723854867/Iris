<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.busap.vcs.data.mapper.SingVoteDAO">  
    

    
    <select id="getMemberRank" resultType="Map">
    	select dest_id as destId,sum(popularity) as total 
    		from sing_vote sv where 
    	user_type=1 
    	and create_at  &gt;=#{startTime} 
    	and create_at  &lt;= #{endTime} 
    	<if test="uid != null">
				AND sv.dest_id = #{uid}
		</if>
    	group by destId 
    	order by total desc limit #{count}; 
    </select>
    
    <select id="getNormalRank" resultType="Map">
    	select dest_id as destId,sum(popularity) as total 
    		from sing_vote sv where 
    	user_type=2 
    	and create_at  &gt;=#{startTime} 
    	and create_at  &lt;= #{endTime} 
    	<if test="uid != null">
				AND sv.dest_id = #{uid}
		</if>
    	group by destId 
    	order by total desc limit #{count}; 
    </select>
    
    <select id="getAnchorRank" resultType="Map">
    	select dest_id as destId,sum(popularity) as total 
    		from sing_vote sv where 
    	user_type=2 
    	and create_at  &lt;= #{endTime} 
    	<if test="uid != null">
				AND sv.dest_id = #{uid}
		</if>
    	group by destId 
    	order by total desc limit #{count}; 
    </select>
    
    <select id="getContributeRank" resultType="Map">
    	select creator_id as creatorId,sum(popularity) as total 
    		from sing_vote sv where 
    	create_at  &gt;=#{startTime} 
    	and create_at  &lt;= #{endTime} 
    	and creator_id > 0
    	<if test="uid != null">
				AND sv.creator_id = #{uid}
		</if>
    	group by creator_id 
    	order by total desc limit #{count}; 
    </select>
    
     <select id="getContributeRankTotal" resultType="Map">
    	select creator_id as creatorId,sum(popularity) as total 
    		from sing_vote sv where 
    	create_at  &gt;=#{startTime} 
    	and create_at  &lt;= #{endTime} 
    	and creator_id > 0
    	<if test="uid != null">
				AND sv.creator_id = #{uid}
		</if>
    	group by creator_id 
    	order by total desc limit #{count}; 
    </select>
    
    
	<select id="selectSingVote" resultType="com.busap.vcs.data.model.SingVoteDisplay" parameterType="map">
		SELECT
		sv.popularity,
		sv.create_at AS createTime,
        sv.modify_at AS updateTime,
		u.username AS operator
		FROM sing_vote sv
		LEFT JOIN user u ON u.id = sv.operation_id
		<where>
			<if test="type != null">
				AND sv.type = #{type}
			</if>
			<if test="destId != null">
				AND sv.dest_id = #{destId}
			</if>
		</where>
	</select>

</mapper>  
