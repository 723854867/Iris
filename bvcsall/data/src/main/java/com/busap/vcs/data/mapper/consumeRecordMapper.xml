<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.busap.vcs.data.mapper.ConsumeRecordDAO">  
    
    <select id="getAnchorTotalRecievePoints" resultType="Long">
    	select sum(cr.points) from consume_record cr 
    	where cr.reciever=#{recieverId}
    	<if test="startTime != null">
    	 	and cr.create_at>#{startTime}
    	</if>
    </select>
    
    <select id="getTotalContributionToAnchor" resultType="Integer">
    	select sum(cr.points) from consume_record cr 
    	where cr.reciever=#{recieverId} and cr.sender=#{senderId}
    	<if test="startTime != null">
    	 	and cr.create_at>#{startTime}
    	</if>
    </select>
    
    <select id="getContributionHistory" resultType="Map">
    	select sum(points) as points,sender from consume_record cr where cr.reciever=#{userId} and cr.points>0 group by sender;
    </select>

	<select id="selectUserPointInfo" resultType="java.lang.Long" parameterType="map">
		select sum(points) as points from consume_record cr
		<where>
			<if test="userId != null">
				AND cr.reciever = #{userId,jdbcType=BIGINT}
			</if>
			<if test="startDate !=null and startDate != ''">
				<![CDATA[ AND cr.create_at >= #{startDate,jdbcType=VARCHAR} ]]>
			</if>
			<if test="endDate !=null and endDate != ''">
				<![CDATA[ AND cr.create_at <= #{endDate,jdbcType=VARCHAR} ]]>
			</if>
		</where>
	</select>

</mapper>  
