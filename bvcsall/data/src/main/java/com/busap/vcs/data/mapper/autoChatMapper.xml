<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.busap.vcs.data.mapper.AutoChatDAO">  
    
    <sql id="page">limit #{pageStart},#{pageSize}</sql>
    <select id="searchList" resultType="com.busap.vcs.data.entity.AutoChat">
    	<![CDATA[
	    	select DISTINCT ac.id as id,ac.uid as uid,ac.words as words,ac.type_id as typeId,ac.`status` as `status`,ac.create_at as createDate,
					(case when ac.type_id!=0 then act.`name` else 'æ— ' end) as typeName,
					(case when ac.uid>0 then r.`name` else '' end) as userName 
			from auto_chat ac LEFT JOIN ruser r on ac.uid=r.id LEFT JOIN auto_chat_type act on act.id=ac.type_id 
			where 1=1
		]]>
		
		<choose>
			<when test="uid != null">
				and ac.uid=#{uid}
			</when>
			<otherwise>
				<if test="typeId != null">
					and ac.type_id=#{typeId}
				</if>
			</otherwise>
		</choose>
		<if test="words != null">
			and ac.words like "%"#{words}"%"
		</if>
		
		order by ac.create_at desc
    	<include refid="page"/>
    </select>
    
    <select id="searchCount" resultType="Integer">
	    <![CDATA[
	    	select COUNT(DISTINCT ac.id) from auto_chat ac LEFT JOIN ruser r on ac.uid=r.id LEFT JOIN auto_chat_type act on act.id=ac.type_id
	    	where 1=1 
		]]>
			
		<choose>
			<when test="uid != null">
				and ac.uid=#{uid}
			</when>
			<otherwise>
				<if test="typeId != null">
					and ac.type_id=#{typeId}
				</if>
			</otherwise>
		</choose>
		<if test="words != null">
			and ac.words like "%"#{words}"%"
		</if>
		
    </select>
    
</mapper>  
